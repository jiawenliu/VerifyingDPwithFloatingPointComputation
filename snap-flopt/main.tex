\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\input{prelude}
\input{ldef}
\usepackage{eucal}
\usepackage{url}
\usepackage{tikz}
\usepackage{amsfonts,amsmath}
\begin{document}

\title{Verifying Snapping Mechanism - Floating Point Implementation Version}
\author{Jiawen Liu}

\date{\today}

\maketitle
In order to verify an implementation of the snapping mechanism
\cite{mironov2012significance} differentially private, we will extend
the logic proposed in~\cite{barthe2016proving} and we will take
inspiration from the floating
point error semantics from
\cite{Ramananandro2016unified,Martel2006higher,Becker2018verified,Moscato2017Automatic}.

\section{Preliminary Definitions}
\begin{defn}
[Laplace mechanism \cite{dwork2006calibrating}]
Let $\epsilon > 0$. The Laplace mechanism  $\lapmech_{\epsilon}$: $\real \to \distr(\real)$ is defined by $\lapmech(t) = t + v$, where $v \in \real$ is drawn from the Laplace distribution $\laplace(\frac{1}{\epsilon})$.
\end{defn}
%
%
%

\section{Syntax - IMP}
\[\begin{array}{llll}
\mbox{Programs} & \prog & ::= & 
	%
     \varx = \expr ~|~ \varx \samplel \edistr
	%
	~|~ \prog ; \prog \\

\mbox{Expr.} & \expr & ::= & \rval ~|~  \fval
	%
	~|~ \varx  ~|~ \expr \bop \expr
	%
	~|~ \uop (\expr) \\
%
\mbox{Binary Operation} & \bop & ::= & + ~|~ - ~|~ \times ~|~ \div \\
%
\mbox{Unary Operation} & \uop & ::= & \ln ~|~ - ~|~ \round{\cdot} 
	%
	~|~ \clamp_B(\cdot) \\
%
\mbox{Value} & \valv & ::= & \rval ~|~  \fval \\
%
\mbox{Distribution} & \edistr & ::= & \uniform(0, 1) 
%
	~|~ \uniform\{-1, 1\}\\ 
%
\mbox{Error} & \err & ::= & (\rval, \rval) \\
%
\mbox{Env.} & \trsenv & ::= & \cdot ~|~ \trsenv[x \mapsto (\fval, \err)] 
%\\
\end{array}
\]

% \mg{Jiawen, please write down a description of the grammar, otherwise
%   it is difficult ot imagine the different components. Especially for expressions.}

We consider a simple imperative language $\prog$ with assignments, random sampling and sequencing, and simple arithmetic expressions $\expr$ with real number $\rval$, floating point number $\fval$, variable $\varx$, binary operations and unary operations.
The errors $\err$ are represented by a pair of real number. The environment maps variable to a floating point number and an error.
%
%
%
\section{Semantics - IMP}
%
The semantics for expressions with relative
floating point computation error are shown in
Figure~\ref{fig_semantics_prog}.
%\mg{I changed the reference because it
% was pointing to the rules for expressions} 
% These rules prove judgment
% of the form $\trsenv, \prog \trsto \trsenv'$, which can be read as:
% the
% programs $\prog$ with environment $\trsenv$ results in the environment
% $\trsenv'$  which contains error bound for all variables \mg{the
%   previous sentence reads funny.}. in
% $\trsenv'$. 
In all the rules, $\eta$ is the machine epsilon.

% \mg{I have some questions about the rules: 
%   \begin{itemize}
%   \item I find confusing the form of judgments for the evaluation of
%     expressions. The form is $\Theta, e\Rightarrow (e',
%     (e_l,e_u))$. One thing I find confusing is why do we want to have
%     e' on the right-hand side of the arrow. As far as I can tell, the
%     only rule that changes the expression is the rule for variables,
%     which performs the substitution you have in the environment. At
%     this point, wouldn't it better to just remove e' and perform the
%     substitution when needed? Perhaps it is just a matter of style but
%     it seems that it could be clearer. Also, if we want to stick with
%     the current formulation, I suspect that there is a series of
%     typos (see below).  
% \item why do you need the condition $c=fl(r)$ in the rule VAL-NEG?
% I imagine that you need a condition which tell us when to apply the
% rule VAL or the rule VAL-NEG or the rule VAL-EQ. At the moment r=fl(r)
% and r is positive you can apply VAL and VAL-EQ, if it is negative you
% can apply VAL-NEG and VAL-EQ, Is this what you want?
% \item what is $f(D)$ and why the rule return it as both upper and
%   lower bound?
% \item the notation max,min in rules BOP and BOP-NEG is confusing. What
%   does this express? I don't understand if the * is a meta-operation
%   here or it is the language level operation. If it is the
%   meta-operation, then I can imagine that you can compute the min and
%   the max. If it is the language level operation, what does it mean
%   taking the min or max of an expression? I see the same problem with
%   the rules for the unary operations. 
% \item what is $e$ in the first premise of the BOP rule? I suspect that
%   you actually mean $e^1_1$, that is another possible expression that
%   is the result of evaluating $e^1$. The second premise has the same
%   problem. Also the right-hand side of the conclusion has the same
%   problem. The same problem is also in rule BOP-NEG and in rules UOP
%   and UOP-NEG.
% \item I am concerned by the rule SAMPLE. Are you sure you want to give
%   a sample based semantics? Why this is better than giving a
%   distribution based semantics like the one we are using in class for
%   pWhile? Also, why there is no error here?
%   \end{itemize}
% }
%
%
\begin{figure}
\begin{mathpar}
\inferrule*[right = var]
{
	\trsenv(\varx) 
	= (\fval, ( \ubar{\rval}, \bar{\rval} ))
}
{
	\trsenv, \varx
	\trsto
	(\fval, ( \ubar{\rval}, \bar{\rval} ))
}
% %
% \and
% %
% \inferrule*[right = var-non]
% {
% 	\varx \notin dom(\trsenv)
% }
% {
% 	\trsenv, \varx
% 	\trsto
% 	(\varx, (\varx, \varx ))
% }
%
\and
%
\inferrule*[right = val]
{
	\fval = \floaten(\rval)
	~~
	\fval \neq \rval
	\and
	\rval \geq 0
}
{
	\trsenv, \rval
	\trsto
	\big(\fval, 
	(\frac{\rval}{(1 + \eta)}, \rval(1 + \eta)) 
	\big)
}
%
\and
%
\inferrule*[right = val-neg]
{
	\fval = \floaten(\rval) 
	~~
	\fval \neq \rval
	\and
	\rval < 0
}
{
	\trsenv, \rval
	\trsto
	\big(\fval, (\rval(1 + \eta), \frac{\rval}{(1 + \eta)}) \big)
}
%
\and
%
\inferrule*[right = val-eq]
{
	\fval = \floaten(\rval)
	~~~~
	\fval = \rval
}
{
	\trsenv, \rval
	\trsto
	(\fval, (\rval, \rval) )
}
%
\and
%
\inferrule*[right = bop-pp]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval_1 \geq 0
	~~~~
	\fval_2 \geq 0
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	* \in \{\times, \div \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    (\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}, 
        (\bar{\rval_1} * \bar{\rval_2})(1 + \eta))
    \big)
}
%
\and
%
\inferrule*[right = bop-nn]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval_1 < 0
	~~~~
	\fval_2 < 0
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	* \in \{\times, \div \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    (\frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)}, 
        (\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta))
    \big)
}
%
\and
%
\inferrule*[right = bop-pn]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval_1 \geq 0
	~~~~
	\fval_2 < 0
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	* \in \{\times, \div \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    ((\bar{\rval_1} * \ubar{\rval_2})(1 + \eta),
    \frac{\ubar{\rval_1} * \bar{\rval_2}}{(1 + \eta)})
    \big)
}
%
\and
%
\inferrule*[right = bop-np]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval_1 < 0
	~~~~
	\fval_2 \geq 0
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	* \in \{\times, \div \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    ((\ubar{\rval_1} * \bar{\rval_2})(1 + \eta),
    \frac{\bar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)})
    \big)
}
%
\and
%
\inferrule*[right = bop-p]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	\fval \geq 0
	~~~~
	* \in \{+, - \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    (\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}, 
        (\bar{\rval_1} * \bar{\rval_2})(1 + \eta))
    \big)
}
%
\and
%
\inferrule*[right = bop-n]
{
	\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
	~~~~
	\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
	~~~~
	\fval = \floaten(\fval_1 * \fval_2)
	~~~~
	\fval < 0
	~~~~
	* \in \{+, - \}
}
{
    \trsenv, \expr_1 * \expr_2
    \trsto
    \big(
    \fval,
    ((\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta),
        \frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)})
    \big)
}
%
\and
%
\inferrule*[right = uop-p]
{
	\trsenv, \expr \trsto (\fval', (\ubar{\rval}, \bar{\rval}))
	~~~~
	\fval = \floaten(\uop (\fval')) 
	~~~~
	\fval \geq 0
}
{
    \trsenv, \uop(\expr)
    \trsto
    \Big(\fval,
    \big(
    \frac{\uop(\ubar{\rval})}{(1 + \eta)}, 
    (\uop(\bar{\rval}))(1 + \eta)
    \big)
    \Big)
}
%
~~~~
%
\inferrule*[right = uop-n]
{
	\trsenv, \expr \trsto (\fval', (\ubar{\rval}, \bar{\rval}))
	~~~~
	\fval = \floaten(\uop (\fval')) 
	~~~~
	\fval < 0
}
{
    \trsenv, \uop(\expr)
    \trsto 
    \Big(\fval,
    \big(\uop(\ubar{\rval})(1 + \eta),
    \frac{\uop(\bar{\rval})}{(1 + \eta)}
    \big)
    \Big)
}
\end{mathpar}
\caption{Semantics of Transition for Expressions with Relative Floating Point Error}
\label{fig_imp_trans_semantics_exp}
\end{figure}
%
%
%
\begin{figure}
\begin{mathpar}
\inferrule*[right = asg]
{
	\trsenv, \expr \trsto (\fval, \err )
}
{
	\trsenv, \varx = \expr
	\trsto
	\trsenv[\varx \mapsto (\fval, \err )]
}
%
~~
%
\inferrule*[right = consq]
{
	\trsenv, \prog_1  \trsto \trsenv_1
	\and
	\trsenv_1, \prog_2  \trsto \trsenv_2
}
{
	\trsenv, \prog_1; \prog_2
	\trsto
	\trsenv_2
}
%
~~
%
\inferrule*[right = sample]
{
	 \fval \leftarrow \edistr^{\diamond}
	 % \and
	 % \rval_1 \leq \fval \leq \rval_2
}
{
	\trsenv, \varx \samplel \edistr
	\trsto
	\trsenv[\varx \mapsto (\fval, (\fval, \fval))]
}
\end{mathpar}
\caption{Semantics of Transition with Relative Floating Point Error Propagation for Programs}
\label{fig_semantics_prog}
\end{figure}


\begin{figure}
\begin{mathpar}
\inferrule*[right = rval]
{
	\floaten(\rval) = \fval
}
{
	\rval
	\fbigstep
	\fval
}
%
~~
%
\inferrule*[right = fval]
{
	\empty
}
{
	\fval
	\fbigstep
	\fval
}
%
~~
%
\inferrule*[right = fbop]
{
	\expr^1 \fbigstep \fval^1
	~~~
	\expr^2 \fbigstep \fval^2
	~~~
	\floaten(\fval^1 \bop \fval^2) = \fval
}
{
    \expr^1 \bop \expr^2 \fbigstep \fval
}
%
~~
%
\inferrule*[right = fuop]
{
	\expr \fbigstep \fval',
	~~~
	\floaten(\uop (\fval')) = \fval
}
{
    \uop(\expr) \fbigstep \fval
}
\end{mathpar}
\caption{Semantics of Evaluation in Floating Point Computation}
\label{fig_imp_real_semantics_exp}
\end{figure}

\begin{figure}
\begin{mathpar}
\inferrule*[right = rval]
{
	\empty
}
{
	\rval
	\rbigstep
	\rval
}
%
~~
%
\inferrule*[right = rval]
{
	\empty
}
{
	\fval
	\rbigstep
	\fval
}
%
~~
%
\inferrule*[right = rbop]
{
	\expr^1 \rbigstep \rval^1
	~~~
	\expr^2 \rbigstep \rval^2
	~~~
	\rval^1 \bop \rval^2 = \rval
}
{
    \expr^1 \bop \expr^2 \rbigstep \rval
}
%
~~
%
\inferrule*[right = ruop]
{
	\expr \rbigstep \rval',
	~~~
	\uop (\rval') = \rval
}
{
    \uop(\expr) \rbigstep \rval
}
\end{mathpar}
\caption{Semantics of Evaluation in Real Computation}
\label{fig_real_semantics_exp}
\end{figure}

\clearpage
% \mg{I suggest to split the theorem proof by adding a lemma that states
% what you want about expressions. This will be used in the case of
% assignment in the theorem.}
\begin{defn}[Bounded Environment]
An environment $\trsenv$ is bounded if and only if that:
$\forall x \in dom(\trsenv)$ s.t. $\trsenv(x) =(\fval, (\ubar{\rval}, \bar{\rval}))$,
 then 
$\ubar{\rval} \leq \fval \leq \bar{\rval}$) 
\end{defn}
%
%
\begin{thm}[Expression Soundness]
\label{thm:expsound}
For any $\expr$, if there exists a transition 
$\trsenv, \expr \trsto (\fval, (\ubar{\rval}, \bar{\rval}))$ 
and $\trsenv$ is a bounded transaction environment
%
then:
%
$$\ubar{\rval} \leq \fval \leq \bar{\rval}.$$
%
\end{thm}
%
%
%
\begin{thm}[Program Soundness]
\label{thm:progsound}
For any $\prog$, if there exists a transition 
$\trsenv, \prog \trsto \trsenv'$ and $\trsenv$ is a bounded transaction environment 
then 
$\trsenv'$ is also a bounded environment.
\end{thm}
%
\begin{proof} of \textbf{Theorem \ref{thm:progsound}}.
%
\\
%
Induction on transition rule of $\prog$, by assumption, we know $\trsenv$ is a bounded environment $(\star)$.
\begin{itemize}
	\caseL{
	\[
	\inferrule*[right = consq]
	{
	\trsenv, \prog_1  \trsto \trsenv_1
	\and
	\trsenv_1, \prog_2  \trsto \trsenv_2
	}
	{
	\trsenv, \prog_1; \prog_2
	\trsto
	\trsenv_2
	}
	\]
	}
	We need to show $\trsenv_2$ is a bounded environment.\\
	%
	Since we know $\trsenv$ is a bounded environment by assumption $(\star)$, by induction hypothesis, we have:
	%
	\\
	$\trsenv_1$ and $\trsenv_2$ are all bounded environment. This case is proved.
%
	\caseL{\[
	\inferrule*[right = sample]
	{
		 \fval \leftarrow \edistr^{\diamond}
		 \and
	 	\rval_1 \leq \fval \leq \rval_2 ~ (\square)
	}
	{
		\trsenv, \varx \samplel \edistr
		\trsto
		\trsenv[\varx \mapsto (\fval, (\rval_1, \rval_2))]
	}
	\]}
	We need to show $\trsenv[\varx \mapsto (\fval, (\fval, \fval))]$ is a bounded environment.\\
	%
	Since we know $\trsenv$ is a bounded environment and $\rval_1 \leq \fval \leq \rval_2$ by assumption $(\star)$ and $(\square)$ .
	%
	\\
	%
	So we know $\trsenv[\varx \mapsto (\fval, (\fval, \fval))]$ is also a bounded environment.
%
	\caseL{\[
	\inferrule*[right = asg]
	{
		\trsenv, \expr \trsto (\fval, (\ubar{\rval}, \bar{\rval}) )
	}
	{
		\trsenv, \varx = \expr
		\trsto
		\trsenv[\varx \mapsto (\fval, (\ubar{\rval}, \bar{\rval}) )]
	}
	\]}
	We need to show: $\trsenv[\varx \mapsto (\expr, \err )]$ is a bounded environment.\\
	%
	By assumption $(\star)$ we know: $\trsenv$ is already a bounded environment. It is sufficient to show:\\
	%
	$\ubar{\rval} \leq \fval \leq \bar{\rval}$.\\
	%
	This is proved by the \textbf{Theorem \ref{thm:expsound}} (expression soundness).
\end{itemize}
\end{proof}
%
%
\begin{proof} of \textbf{Theorem \ref{thm:expsound}}.
%
\\
%
Induction on the transition rule of $\expr$, by assumption, we know $\trsenv$ is a bounded environment $(\star)$.
%
	\begin{itemize}
%
	\caseL{
	\[\inferrule*[right = var]
		{
			\trsenv(\varx) 
			= (\fval, ( \ubar{\rval}, \bar{\rval} ))
		}
		{
			\trsenv, \varx
			\trsto
			(\fval, ( \ubar{\rval}, \bar{\rval} ))
		}\]
		}
	By the assumption, we have $\forall \varx \in dom(\trsenv)$ s.t. $\trsenv(\varx) = (\fval, (\ubar{\rval}, \bar{\rval}))$, 
	$\ubar{\rval} \leq \fval \leq \bar{\rval}$.
	This case is proved.
	%
	%
	\caseL{
	\[\inferrule*[right = val]
		{
			\fval = \floaten(\rval)
			\and
			\fval \neq \rval
			\and
			\rval \geq 0
		}
		{
			\trsenv, \rval
			\trsto
			\big(\fval, 
			(\frac{\rval}{(1 + \eta)}, \rval(1 + \eta)) 
			\big)
		}
		\]
	}
	%
	By the definition of floating point rounding error and $\rval \geq 0$, we have:
	%
	$\frac{\rval}{(1 + \eta)}
	\leq \fval \leq
	\rval(1 + \eta)$
	%
	%
	\caseL{\[
	\inferrule*[right = val-neg]
	{
		\fval = \floaten(\rval) 
		\and
		\fval \neq \rval
		\and
		\rval < 0
	}
	{
		\trsenv, \rval
		\trsto
		\big(\fval, (\rval(1 + \eta), \frac{\rval}{(1 + \eta)}) \big)
	}
	\]}
	%
	By the definition of floating point rounding error and $\rval < 0$, we have:
	%
	$\rval(1 + \eta)
	\leq \fval \leq
	\frac{\rval}{(1 + \eta)}$
	%
	\caseL{\[
		\inferrule*[right = val-eq]
		{
			\fval = \floaten(\rval)
			~~~~
			\fval = \rval
		}
		{
			\trsenv, \rval
			\trsto
			(\fval, (\rval, \rval) )
		}
	\]}
	%
	It is trivial that $\rval \leq \fval = \floaten(\rval) = \rval \leq \rval$
	%
	\caseL{\[
	\inferrule*[right = bop-pp]
	{
		\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1})) ~ (\diamond)
		~~~
		\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2})) ~ (\triangle)
		~~~
		\fval_1 \geq 0
		~~~
		\fval_2 \geq 0
		~~~
		\fval = \floaten(\fval_1 * \fval_2)
		~~~
		* \in \{\times, \div \}
	}
	{
	    \trsenv, \expr_1 * \expr_2
	    \trsto
	    \big(
	    \fval,
	    (\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}, 
	    (\bar{\rval_1} * \bar{\rval_2})(1 + \eta))
	    \big)
	}
	\]}
	%
	It is needed to show $\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}
	\leq \fval \leq 
	(\bar{\rval_1} * \bar{\rval_2})(1 + \eta)$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let $\bar{\rval'} = 
	\bar{\rval_1} * \bar{\rval_2}$ and 
	%
	$\ubar{\rval'} = \ubar{\rval_1} * \ubar{\rval_2}$.
	%
	\\
	%
	By (1), (2) and hypothesis: $\fval_1 \geq 0$, $\fval_2 \geq 0$ and $* \in \{\times, \div\}$, we have:
	%
	$\fval \geq 0
	\land
	\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by relative error of floating point rounding, we have:\\
	%
	$\frac{\ubar{\rval'}}{1 + \eta}
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq (\bar{\rval'})(1 + \eta)$.
	%
	%
	This case is proved.
	%
	\caseL{\[
		\inferrule*[right = bop-nn]
		{
			\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
			~~~~
			\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
			~~~~
			\fval_1 < 0
			~~~~
			\fval_2 < 0
			~~~~
			\fval = \floaten(\fval_1 * \fval_2)
			~~~~
			* \in \{\times, \div \}
		}
		{
		    \trsenv, \expr_1 * \expr_2
		    \trsto
		    \big(
		    \fval,
		    (\frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)}, 
		        (\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta))
		    \big)
		}
	\]}
	%
	%
	It is needed to show 
	$\frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)}
	\leq \fval \leq 
	(\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta)$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let $\bar{\rval'} = 
	\ubar{\rval_1} * \ubar{\rval_2}$ and 
	%
	$\ubar{\rval'} = \bar{\rval_1} * \bar{\rval_2}$.
	%
	\\
	%
	By (1), (2) and hypothesis: $\fval_1 < 0$, $\fval_2 < 0$ and $* \in \{\times, \div\}$, we have:
	%
	$\fval \geq 0
	\land
	\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by relative error of floating point rounding, we have:\\
	%
	$\frac{\ubar{\rval'}}{1 + \eta}
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq (\bar{\rval'})(1 + \eta)$.
	%
	%
	This case is proved.
	%
	%
	\caseL{\[
	\inferrule*[right = bop-pn]
		{
			\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
			~~~~
			\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
			~~~~
			\fval_1 \geq 0
			~~~~
			\fval_2 < 0
			~~~~
			\fval = \floaten(\fval_1 * \fval_2)
			~~~~
			* \in \{\times, \div \}
		}
		{
		    \trsenv, \expr_1 * \expr_2
		    \trsto
		    \big(
		    \fval,
		    ((\bar{\rval_1} * \ubar{\rval_2})(1 + \eta),
		    \frac{\ubar{\rval_1} * \bar{\rval_2}}{(1 + \eta)})
		    \big)
		}
	\]}
	%
	%
	It is needed to show 
	$(\bar{\rval_1} * \ubar{\rval_2})(1 + \eta)
	\leq \fval \leq 
	\frac{\ubar{\rval_1} * \bar{\rval_2}}{(1 + \eta)}$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let $\bar{\rval'} = 
	\ubar{\rval_1} * \bar{\rval_2}$
	and 
	%
	$\ubar{\rval'} = \bar{\rval_1} * \ubar{\rval_2}$.
	%
	\\
	%
	By (1), (2) and hypothesis: $\fval_1 \geq 0$, $\fval_2 < 0$ and $ * \in \{\times, \div\}$, we have:
	%
	$\fval < 0
	\land
	\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by relative error of floating point rounding, we have:\\
	%
	$\ubar{\rval'}(1 + \eta)
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq \frac{\bar{\rval'}}{1 + \eta}$.
	%
	%
	This case is proved.
	%
	%
	\caseL{\[
	\inferrule*[right = bop-np]
		{
			\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
			~~~~
			\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
			~~~~
			\fval_1 < 0
			~~~~
			\fval_2 \geq 0
			~~~~
			\fval = \floaten(\fval_1 * \fval_2)
			~~~~
			* \in \{\times, \div \}
		}
		{
		    \trsenv, \expr_1 * \expr_2
		    \trsto
		    \big(
		    \fval,
		    ((\ubar{\rval_1} * \bar{\rval_2})(1 + \eta),
		    \frac{\bar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)})
		    \big)
		}
	\]}
    % 
 	%
 	It is needed to show 
	$(\ubar{\rval_1} * \bar{\rval_2})(1 + \eta)
	\leq \fval \leq 
	\frac{\bar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let 
	$\bar{\rval'} = \bar{\rval_1} * \ubar{\rval_2}$
	and 
	%
	$\ubar{\rval'} = \ubar{\rval_1} * \bar{\rval_2}$.
	%
	\\
	%
	By (1), (2) and hypothesis: $\fval_1 < 0$, $\fval_2 \geq 0$ and $ * \in \{\times, \div\}$, we have:
	%
	$\fval < 0
	\land
	\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by relative error of floating point rounding, we have:\\
	%
	$\ubar{\rval'}(1 + \eta)
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq \frac{\bar{\rval'}}{1 + \eta}$.
	%
	%
	This case is proved.
    %
    %
    %
    \caseL{\[
	\inferrule*[right = bop-p]
	{
		\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
		~~~~
		\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
		~~~~
		\fval = \floaten(\fval_1 * \fval_2)
		~~~~
		\fval \geq 0
		~~~~
		* \in \{+, - \}
	}
	{
	    \trsenv, \expr_1 * \expr_2
	    \trsto
	    \big(
	    \fval,
	    (\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}, 
	    (\bar{\rval_1} * \bar{\rval_2})(1 + \eta))
	    \big)
	}
    \]}
    %
    %
 	It is needed to show 
	$\frac{\ubar{\rval_1} * \ubar{\rval_2}}{(1 + \eta)}
	\leq \fval \leq 
	(\bar{\rval_1} * \bar{\rval_2})(1 + \eta)$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let 
	$\bar{\rval'} = \bar{\rval_1} * \bar{\rval_2}$
	and 
	%
	$\ubar{\rval'} = \ubar{\rval_1} * \ubar{\rval_2}$.
	%
	By (1), (2) and hypothesis: $ * \in \{+, -\}$, we have:
	%
	$\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by hypothesis: $\fval \geq 0$ and relative error of floating point rounding, we have:\\
	%
	$\frac{\ubar{\rval'}}{1 + \eta}
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq \bar{\rval'}(1 + \eta)$.
	%
	This case is proved.
	%
	%
	%
    \caseL{\[
    \inferrule*[right = bop-n]
		{
			\trsenv, \expr_1 \trsto (\fval_1, (\ubar{\rval_1}, \bar{\rval_1}))
			~~~~
			\trsenv, \expr_2 \trsto (\fval_2, (\ubar{\rval_2}, \bar{\rval_2}))
			~~~~
			\fval = \floaten(\fval_1 * \fval_2)
			~~~~
			\fval < 0
			~~~~
			* \in \{+, - \}
		}
		{
		    \trsenv, \expr_1 * \expr_2
		    \trsto
		    \big(
		    \fval,
		    ((\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta),
		    \frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)})
		    \big)
		}
    \]}
    %
    %
 	It is needed to show 
	$(\ubar{\rval_1} * \ubar{\rval_2})(1 + \eta)
	\leq \fval \leq 
	\frac{\bar{\rval_1} * \bar{\rval_2}}{(1 + \eta)}$.\\
	%
	By induction hypothesis on $(\diamond)$ and $(\triangle)$, we have:\\
	%
	(1) $\ubar{\rval_1} \leq \fval_1 \leq \bar{\rval_1}$ holds. 
	%
	(2) $\ubar{\rval_2} \leq \fval_2 \leq \bar{\rval_2}$ holds.\\
	%
	Let 
	$\bar{\rval'} = \ubar{\rval_1} * \ubar{\rval_2}$
	and 
	%
	$\ubar{\rval'} = \bar{\rval_1} * \bar{\rval_2}$.
	%
	By (1), (2) and hypothesis: $ * \in \{+, -\}$, we have:
	%
	$\ubar{\rval'}
	\leq \fval_2 \bop \fval_1
	\leq \bar{\rval'}$.\\
	%
	Then by hypothesis: $\fval \geq 0$ and relative error of floating point rounding, we have:\\
	%
	$\ubar{\rval'}(1 + \eta)
	\leq \floaten(\fval_2 \bop \fval_1) = \fval
	\leq \frac{\bar{\rval'}}{1 + \eta}$.
	%
	This case is proved.
	%
	%
    %
	\caseL
	{
	\[
		\inferrule*[right = uop-p]
		{
			\trsenv, \expr \trsto (\fval', (\ubar{\rval}, \bar{\rval})) 
			~(\diamond)
			~~~~
			\fval = \floaten(\uop (\fval')) 
			~~~~
			\fval \geq 0
		}
		{
		    \trsenv, \uop(\expr)
		    \trsto
		    \Big(\fval,
		    \big(
		    \frac{\uop(\ubar{\rval})}{(1 + \eta)}, 
		    (\uop(\bar{\rval}))(1 + \eta)
		    \big)
		    \Big)
		}
	\]
	}
	%
 	It is sufficient to show 
	$\frac{\uop(\ubar{\rval})}{1 + \eta}
	\leq \fval \leq 
	(\uop(\bar{\rval}))(1 + \eta)$.\\
	%
	By induction hypothesis on $(\diamond)$, we have:\\
	%
	(1) $\ubar{\rval} \leq \fval' \leq \bar{\rval}$ holds.
	%
	\\
	%
	By (1) and monotone of unary operators, we have:
	%
	$\uop(\ubar{\rval})
	\leq \uop(\fval')
	\leq \uop(\bar{\rval})$.\\
	%
	Then by hypothesis: $\fval \geq 0$ and relative error of floating point rounding, we have:\\
	%
	$\frac{\uop(\ubar{\rval})}{1 + \eta}
	\leq \floaten(\uop(\fval')) = \fval
	\leq \uop(\bar{\rval})(1 + \eta)$.
	%
	This case is proved.
	%
	\subcaseL
	{
	\[
	\inferrule*[right = uop-n]
	{
		\trsenv, \expr \trsto (\fval', (\ubar{\rval}, \bar{\rval}))
		~~~~
		\fval = \floaten(\uop (\fval')) 
		~~~~
		\fval < 0
	}
	{
	    \trsenv, \uop(\expr)
	    \trsto 
	    \Big(\fval,
	    \big(\uop(\ubar{\rval})(1 + \eta),
	    \frac{\uop(\bar{\rval})}{(1 + \eta)}
	    \big)
	    \Big)
	}
	\]
	}
	%
	%
 	It is sufficient to show 
	$\big(\uop(\ubar{\rval})(1 + \eta)
	\leq \fval \leq 
	\frac{\uop(\bar{\rval})}{(1 + \eta)}$.\\
	%
	By induction hypothesis on $(\diamond)$, we have:\\
	%
	(1) $\ubar{\rval} \leq \fval' \leq \bar{\rval}$ holds.
	%
	\\
	%
	By (1) and monotone of unary operators, we have:
	%
	$\uop(\ubar{\rval})
	\leq \uop(\fval')
	\leq \uop(\bar{\rval})$.\\
	%
	Then by hypothesis: $\fval < 0$ and relative error of floating point rounding, we have:\\
	%
	$\big(\uop(\ubar{\rval})(1 + \eta)
	\leq \floaten(\uop(\fval')) = \fval
	\leq \frac{\uop(\bar{\rval})}{(1 + \eta)}$.
	%
	This case is proved.
	%
	%
\end{itemize}
%
\end{proof}

\newpage
\section{Snapping Mechanism}

\begin{defn}
[$\snap(a) : A \to \distr(\real)$]
Given privacy parameter $\epsilon$, the Snapping mechanism $\snap(a)$ is defined as:
\[
	U \samplel \uniform(0,1); S \samplel \uniform\{-1, 1\};
	x = \clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (U)}_{\Lambda}
	\big)
\]
where $f(a)$ represents a value that the query function $f$ be evaluted over input database $a \in A$, $\epsilon$ is the privacy parameter, $B$ is the clamping argument and $\Lambda$ is the rounding argument satisfying $\lambda = 2^k$ where $2^k$ is the smallest power of 2 greater or equal to the $\frac{1}{\epsilon}$.
%
% \\
% %
% Given $U = u, S = s$, let $\expr_{\snap'} = f(a) + s \times \ln (u) \div \epsilon$,
% $\expr_{\snap''} = \clamp_B \big( \round{\rval_{\snap'} }_{\Lambda} \big)$
% %
% \\
% %
% Let $\snap'(a)$ be the same as $\snap(a)$ given $U = u, S = s$ without rounding and clamping steps, i.e., $\snap'(a): y = \expr_{\snap'}$,
% and $\snap''(a): z = \expr_{\snap''}$.
\end{defn}
%
%
%
\begin{lem}[sign]
\label{lem:sign}
For any input $a$ and output $\varx$ where
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (U)}_{\Lambda}
	\big)
	\fbigstep \varx$ 
or $\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (U)}_{\Lambda}
	\big)
	\rbigstep \varx$,
%
\begin{enumerate}  
	\item if $\varx < f(a)$, then $S = 1$;
	\item if $\varx = f(a)$, then $S = 1$ or $ -1$;
	\item if $\varx > f(a)$, then $S = -1$.
\end{enumerate}
\end{lem}
%
%
%
\begin{lem}
[clampL]
\label{lem:clampl}
For any input $a$:
\begin{enumerate}
\item 
if 
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep -B$ or $B$, then $u \in (0, \fvalR)$ for some $\fvalR$.
	%
\item
if
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\rbigstep -B$ or $B$, then $u \in (0, \rvalR)$ for some $\rvalR$.
\end{enumerate}
\end{lem}


\begin{lem}[clampR]
\label{lem:clampr}
For any input $a$:
\begin{enumerate}
\item 
if 
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep -B$ or $B$ and $u \in (\fvalL, \fvalR)$ for some $\fvalL, \fvalR$.
	%
	\\
	%
	 Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$, 
	 then:
	 %
	 \\
	 %
	$f(a) + \frac{1}{\epsilon} \times s \times \ln (u) \fbigstep -b - \frac{\Lambda}{2}$ or $b + \frac{\Lambda}{2}$.
%
\item
	%
	%
if
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\rbigstep -B$ or $B$ and $U \in (\rvalL, \rvalR)$ for some $\rvalL, \rvalR$.
	%
	\\
	%
	 Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$, 
	 then:
	 %
	 \\
	 %
	$f(a) + \frac{1}{\epsilon} \times S \times \ln (U) \rbigstep -b - \frac{\Lambda}{2}$ or $b + \frac{\Lambda}{2}$.
\end{enumerate}
\end{lem}


\begin{lem}[clampId]
\label{lem:clampid}
For any input $a$:
\begin{enumerate}
\item 
if 
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep \valv$ and $\valv \in (-B, B)$, then:
	%
	$\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (u)}_{\Lambda}
	\fbigstep \valv$
%
\item
	%
	%
if
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (U)}_{\Lambda}
	\big)
	\rbigstep \valv$ and $\valv \in (-B, B)$, then:
	%
	$\round{f(a) + \frac{1}{\epsilon} \times S \times \ln (u)}_{\Lambda}
	\rbigstep \valv$
\end{enumerate}
\end{lem}


\begin{lem}[RoundRL]
\label{lem:roundrl}
For any input $a$ and output $\valv \in (-B, B)$,
let $(\fvalL, \fvalR)$ be the largest range s.t. 
$\forall u \in (\fvalL, \fvalR)$ and some $s$:
%
$$
\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep \valv,$$
then:
$$
f(a) + \frac{1}{\epsilon} \times s \times 
\ln (\fvalL)
\fbigstep \varx - \frac{\Lambda}{2}
~~~~~~~~~~~~~~~~
f(a) + \frac{1}{\epsilon} \times s \times 
\ln (\fvalR)
\fbigstep \valv + \frac{\Lambda}{2}
$$
\end{lem}

% \begin{defn}
% [$\snap(a) : A \to \distr(\real)$]
% Given privacy parameter $\epsilon$, the floating point implemented
% Snapping mechanism $\snap(a)$ is defined as (where all parameters are defined the same as above):
% \[
% 	u_{\mathbb{F}} \xleftarrow{\$} \edistr;
% 	s_{\mathbb{F}} \samplel \{-1, 1\};
% 	z = \clamp_B \big(
% 	\round{f(a) \oplus s \otimes \oln (u) \odiv \epsilon}_{\Lambda}
% 	\big)
% \]
% Let $\snap'(a)$ be the same as $\snap(a)$ without rounding and clamping steps given $u, s$.
% \end{defn}
\begin{lem}[idealRL]
\label{lem:idealrl}
For any input $a$ and output $\valv \in (-B, B)$,
let $(\rvalL, \rvalR)$ be the largest range where 
$\forall u \in (\rvalL, \rvalR)$ and some $s$ s.t.:
%
$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
\rbigstep \valv
$, then:
%
$$
\rvalL = e^{\epsilon(\valv - \Lambda/2 - f(a))/s}
~~~~~~~~~~~~~~~~~~~~~~~~~~
\rvalR = e^{\epsilon(\valv + \Lambda/2 - f(a))/s}
$$
and 
$\Pr[\snap(a) = \valv] = 1/2(\rvalR - \rvalL)$.
\end{lem}

\begin{lem}[idealDP]
\label{lem:idealdp}
The $\snap$ mechanism in real computation is differentially private.
\end{lem}

\newpage
\section{Main Theorem}

\begin{thm}
[The $\snap$ mechanism is $(\epsilon + 23 B \epsilon \eta, 0)-$differentially private]
%
Consider the $\snap$ mechanism defined as before. For any privacy parameter $\epsilon$ representable in floating point computation, for all possible outputs $\varx$ in floating point computation and pairs of adjacent input $a$ and $a'$ satisfying $|f(a) - f(a')| \leq 1$, the privacy loss between $\snap(a)$ and $\snap(a')$ is bounded by $e^{\epsilon + 23 B \epsilon \eta}$.
\end{thm}

\begin{proof}
%
%
We consider following setting:
\\
1. $\valv$ is a possible output of $\snap(a)$ in floating point computation,
%
\\
2. any pair of adjacent database $a'$ and $a$ where $|f(a) - f(a')| \leq 1$
%
\\
3. and any parameter $\epsilon$ representable in floating point computation.
%
\\
Without loss of generality, we assume $f(a) + 1 = f(a') ~ (\diamond)$.
%
\\
%
%
Let $(\rvalL, \rvalR)$, $(\rvalL', \rvalR')$ be the range where 
$\forall u \in (\rvalL, \rvalR)$ and some $s$, 
$\forall u' \in (\rvalL', \rvalR')$ and some $s'$, s.t.:
%
$$\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	 \rbigstep \valv; 
~~~~~~~~~~~~~~~~~~
\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	 \rbigstep \valv.$$
%
By \textbf{Lemma \ref{lem:idealrl}}, we have:
$\Pr[\snap(a) = \valv] = \frac{1}{2} (\rvalR - \rvalL)$ 
and $\Pr[\snap(a') = \valv] = \frac{1}{2} (\rvalR' - \rvalL')$.
%
\\
%
By \textbf{Lemma \ref{lem:idealdp}}, we can get:
\[
	e^{-\epsilon} \leq \frac{\Pr[\snap(a)]}{\Pr[\snap(a')]}
	= \frac{\rvalR - \rvalL}{\rvalR' - \rvalL'} \leq e^{\epsilon}
\]
%
\\
%
Let $(\fvalL, \fvalR)$, $(\fvalL', \fvalR')$ be the largest range where 
$\forall u \in (\fvalL, \fvalR)$ and some $s$, 
$\forall u' \in (\fvalL', \fvalR')$ and some $s'$, s.t.:
%
$$
\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep \varx; 
~~~~~~~~~~~~~~~~~~
\clamp_B \big(
	\round{f(a) + \frac{1}{\epsilon} \times s \times \ln (u)}_{\Lambda}
	\big)
	\fbigstep \varx.$$
%
To show the privacy loss between $\snap(a)$ and $\snap(a')$ is bounded by $e^{\epsilon + 23 B \epsilon \eta}$, itâ€™s sufficient to show:
%
%
$h(|{\rvalR} - {\rvalL}|) \leq |\fvalR - \fvalL| \leq g(|{\rvalR} - {\rvalL}|)$ and 
$h(|{\rvalR'} - {\rvalL'}|) \leq |\fvalR' - \fvalL'|
\leq g(|{\rvalR'} - {\rvalL'}|) $,
%
s.t.:
%
\[
	-(\epsilon + 23 B \epsilon \eta)
	\leq \ln( \frac{h(|{\rvalR} - {\rvalL}|)}{g(|{\rvalR'} - {\rvalL'}|)} ) 
	\leq
	\ln( \frac{g(|{\rvalR} - {\rvalL}|)}{h(|{\rvalR'} - {\rvalL'}|)} )
	\leq \epsilon + 23 B \epsilon \eta.
\]

%
Induction on the outputspace of $\snap(a)$ mechanism, we have following cases:
	%
	\begin{itemize}
		%
		% \item[\textbf{case}] $\boldsymbol{x = -B}$
		\caseL{$\boldsymbol{\valv = -B}$}
		%
		Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$, $b' = b + \Lambda / 2$.
		% %
		\\
		%
		By Lemma \ref{lem:sign}, \ref{lem:clampr} and \ref{lem:clampl} we know $s = 1$, 
		$U \in (0, \fvalR)$ for some $\fvalR$
		, $U \in (0, \rvalR)$ for some $\rvalR$ s.t.:.
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln(\fvalR) \fbigstep -b' ~~~ (1)
		~~~~~~~~~~~~~~~~
		f(a) + \frac{1}{\epsilon} \times \ln(\rvalR) \rbigstep -b' ~~~ (2)
		$$
		\\
		%
		So we can get $\fvalL = \rvalL = 0$.
		%
		\\
		%
		In order to bound the $\fvalR$ by $\rvalR$, let $P$ be the real representation of $\fvalR~(\star)$ . we have the derivation as following:
\\
		% \begin{figure}
{\scriptsize
\begin{mathpar}
	\inferrule*[right=bop]
	{
	\inferrule*[right=bop]
	{
		\inferrule*[right = uop]
		{
			\inferrule*[right = val-eq]
			{
				P ~~~ \text{representable}
			}
			{
				\trsenv, P 
				\trsto
				(\fvalR,
				(P, P))
			}
		}
		{
				\trsenv,
				\ln(P) 
				\trsto
				(\ln(\fvalR), \ln(P)(1 + \eta),
				\frac{\ln(P)}{(1 + \eta)})
			}
			\and
			\inferrule*[right = val-eq]
			{
			\frac{1}{\epsilon}~ \text{representable}
			}
			{
				\frac{1}{\epsilon} \trsto
				(\frac{1}{\epsilon},
				(\frac{1}{\epsilon},
			\frac{1}{\epsilon}))	
			}
		}
			{
					\trsenv,
					\frac{1}{\epsilon} \times \ln(P) 
					\trsto
					(\frac{1}{\epsilon} \times \ln(\fvalR),
					((\frac{1}{\epsilon} \times \ln(P))(1 + \eta)^2,
					%
					\frac{\frac{1}{\epsilon} \times \ln(P)}{(1 + \eta)^2}))
				}
					\and
				\inferrule*[right=val-eq]
				{f(a) ~~ \text{representable}}
				{	[],
				f(a) \trsto
				(f(a),(f(a),f(a)))
				}
			}
				{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalR),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				\frac{(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}
				 \big)
				\bigg)
				}
		\end{mathpar}	
}		%
		%
		By Soundness Theorem and $(1)$, we have:
		% 
		%
		\[
		(f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)}
		\leq
		-b'
		\leq
		\frac{(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}
				 \big)
				\bigg)
		\]
		Then we can get:
		%
		\[
		e^{\epsilon 
		\big( (-b'(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq
		P
		\leq
		e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}}
		\]
		%
		By $(\star)$ we know: $P = \fvalR$, so we have:
		%
		\[
		e^{\epsilon 
		\big( (-b'(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq
		\fvalR
		\leq
		e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}}
		\]
		%
		\\		
		%
		In the same way, we get:
		%
		%
		\[
		e^{\epsilon 
		\big((-b'(1 + \eta) - f(a'))(1 + \eta)^2 \big)}
		\leq
		\fvalR'
		%
		\leq
		e^{\epsilon 
		(\frac{(\frac{-b'}{1 + \eta} - f(a'))}{(1 + \eta)^2})}
		\]
		%		
		Then we have that the $|\fvalR - \fvalL| = |\fvalR - 0|$ is bounded by 
		$e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}}$ 
		and $e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}}$;
		%
		\\
		and $|\fvalR' - \fvalL'| = |\fvalR' - 0|$ is bounded by 
		$e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$ 
		and $e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$;
		

		So the privacy loss in this case is bounded by:
		%
		\[
		\begin{array}{ll}
		\frac
		{\frac{1}{2}(e^{\epsilon 
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}})}
		{\frac{1}{2}(e^{\epsilon 
		\big((-b'(1 + \eta) - f(a'))(1 + \eta)^2 \big)})}
		& = e^{\epsilon
		\bigg(
		\frac{(\frac{-b'}{1 + \eta} - f(a))}{(1 + \eta)^2}
		-
		\big((-b'(1 + \eta) - f(a'))(1 + \eta)^2 \big)
		\bigg)}\\
		& = e^{\epsilon
		\bigg(
		\frac{-b'}{(1 + \eta)^3} - \frac{f(a)}{(1 + \eta)^2}
		-
		x(1 + \eta)^3 + f(a')(1 + \eta)^2 
		\bigg)} ~ (\triangle)
		\end{array}
		\]
		%
		Since $ (1 + \eta)^3 > 1 + 3\eta$,  $\frac{1}{(1 + \eta)^3} < \frac{1}{1 + 3\eta} $, $(1 + \eta)^2 < 1 + 2.1\eta$ and $\frac{1}{(1 + \eta)^2} > 1 - 2 \eta$, we have:
		%
		\[
		\begin{array}{ll}
		e^0
		<
		~~~ (\triangle) & < e^{\epsilon \big( 
		\frac{9\eta + 6}{1 + 3\eta} b'
		+ 4.1 \eta f(a)
		+ (1 + 2.1\eta) 
		\big)}\\
		%
		& < e^{\epsilon(10.1 \eta B + 1 + 2.1\eta)}
		\end{array}
		\]
		%
		%
		%
		%
		\caseL{
		$\boldsymbol{\valv \in (-B, \round{f(a)}_{\Lambda})} ~ (\star) $
		}
		%
		\subcaseL{
		$\boldsymbol{
		\round{f(a)}_{\Lambda} \leq 0 
		%
		\lor \bigg( \round{f(a)}_{\Lambda} > 0 \land \valv \in (-B, 0) \bigg) } ~ (\star_1) $
		}
		%
		Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv + (\frac{\Lambda}{2})$.
		By $(\star_1)$, 
		we know $\valv_1 < 0$, $\valv_2 < 0$.
		%
		\\
		%
		By Lemma and $(\star) $, we know: $\rvalL = e^{\epsilon(y_1 - f(a))}$ and 
		$\rvalR = e^{\epsilon(y_2 - f(a))}$.
		%
		\\
		%
		By Lemma \ref{lem:roundrl}, we know:
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln(\fvalL) \fbigstep \valv_1 ~~ (1)
		~~~~~~~~~~~~~~~~~
		f(a) + \frac{1}{\epsilon} \times \ln(\fvalR) \fbigstep \valv_2 ~~ (2).$$
		%
	In order to bound $\fvalL$ in terms of $\rvalL$, we have the following derivation where $P$ be the real representation of $\fvalL ~~ (\diamond)$:
		%
{\scriptsize
\begin{mathpar}
	\inferrule*[right=bop]
	{
	\inferrule*[right=bop]
	{
		\inferrule*[right = uop]
		{
			\inferrule*[right = val-eq]
			{
				P ~~~ \text{representable}
			}
			{
				\trsenv, P 
				\trsto
				(\fvalL,
				(P, P))
			}
		}
		{
				\trsenv,
				\ln(P) 
				\trsto
				(\ln(\fvalL), \ln(P)(1 + \eta),
				\frac{\ln(P)}{(1 + \eta)})
			}
			\and
			\inferrule*[right = val-eq]
			{
			\frac{1}{\epsilon}~ \text{representable}
			}
			{
				\frac{1}{\epsilon} \trsto
				(\frac{1}{\epsilon},
				(\frac{1}{\epsilon},
			\frac{1}{\epsilon}))	
			}
		}
			{
					\trsenv,
					\frac{1}{\epsilon} \times \ln(P) 
					\trsto
					(\frac{1}{\epsilon} \times \ln(\fvalL),
					((\frac{1}{\epsilon} \times \ln(P))(1 + \eta)^2,
					%
					\frac{\frac{1}{\epsilon} \times \ln(P)}{(1 + \eta)^2}))
				}
					\and
				\inferrule*[right=val-eq]
				{f(a) ~~ \text{representable}}
				{	[],
				f(a) \trsto
				(f(a),(f(a),f(a)))
				}
			}
				{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalL),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				\frac{(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}
				 \big)
				\bigg)
				}
		\end{mathpar}	
}
%
%
		By soundness theorem and (1), we have:
		%
		\[
		(f(a) + (\frac{1}{\epsilon} \times \ln(P))
		(1 + \eta)^2){(1 + \eta)}
		\leq \valv_1 \leq
		\frac{(f(a) + \frac{\frac{1}{\epsilon} 
		\times \ln(P)}{(1 + \eta)^2})}
		{(1 + \eta)}
		\]
		%
		%
		Then we have:
		$$e^{\epsilon 
				\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq P \leq
		e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}.$$
		%
		%
		By $(\diamond)$, we have:
		$$e^{\epsilon 
				\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq \fvalL \leq
		e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}.$$
		%
		%
		\\
		%
	In order to bound $\fvalR$ in terms of $\rvalR$, we have the following derivation where $P$ be the real representation of $\fvalR ~~ (\diamond)$:
		%
{\scriptsize
\begin{mathpar}
	\inferrule*[right=bop]
	{
	\inferrule*[right=bop]
	{
		\inferrule*[right = uop]
		{
			\inferrule*[right = val-eq]
			{
				P ~~~ \text{representable}
			}
			{
				\trsenv, P 
				\trsto
				(\fvalR,
				(P, P))
			}
		}
		{
				\trsenv,
				\ln(P) 
				\trsto
				(\ln(\fvalR), \ln(P)(1 + \eta),
				\frac{\ln(P)}{(1 + \eta)})
			}
			\and
			\inferrule*[right = val-eq]
			{
			\frac{1}{\epsilon}~ \text{representable}
			}
			{
				\frac{1}{\epsilon} \trsto
				(\frac{1}{\epsilon},
				(\frac{1}{\epsilon},
			\frac{1}{\epsilon}))	
			}
		}
			{
				\trsenv,
				\frac{1}{\epsilon} \times \ln(P) 
				\trsto
				(\frac{1}{\epsilon} \times \ln(\fvalR),
				((\frac{1}{\epsilon} \times \ln(P))(1 + \eta)^2,
				%
				\frac{\frac{1}{\epsilon} \times \ln(P)}{(1 + \eta)^2}))
			}
			\and
			\inferrule*[right=val-eq]
			{f(a) ~~ \text{representable}}
			{	[],
			f(a) \trsto
			(f(a),(f(a),f(a)))
		   }
		}
			{
			\trsenv,
			f(a) + \frac{1}{\epsilon} \times \ln(P)
			\trsto
			\bigg(
			f(a) + \frac{1}{\epsilon} \times \ln(\fvalR),
			%
		\big( (f(a) + 
		(\frac{1}{\epsilon} \times \ln(P))
		(1 + \eta)^2)
		{(1 + \eta)},
				%
		\frac{(
		f(a) + \frac{\frac{1}{\epsilon} 
		\times \ln(P)}
		{(1 + \eta)^2}
		)}
		{(1 + \eta)}
		 \big)
		\bigg)
		}
		\end{mathpar}	
}
%
%
		By soundness theorem and (2), we have:
		\[
		(f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)}
		\leq \valv_2 \leq
			\frac{(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}		
		\]
		Then, we can get:
		%
		\\ 
		$$
		e^{\epsilon 
		\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq
		P
		\leq
		e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}.$$
		%
		By $(\diamond)$, we can get:
		%
		\\ 
		$$
		e^{\epsilon 
		\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq
		\fvalR
		\leq
		e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}.$$		

		In the same way, we have the bounds for $\fvarL', \fvarR'$ for input $a'$ as:

		$$e^{\epsilon 
				\big( (\valv_1(1 + \eta) - f(a')) (1 + \eta)^2) \big)}
		\leq \fvarL' \leq
		e^{\epsilon 
				\frac{(\frac{\valv_1}{1 + \eta} - f(a'))}{(1 + \eta)^2}}.$$
		%
		%
		$$ 
		e^{\epsilon 
				\big( (\valv_2(1 + \eta) - f(a')) (1 + \eta)^2) \big)}
		\leq \fvarR' \leq
		e^{\epsilon 
				\frac{(\frac{\valv_2}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$$

		Let  $h{(\fvalL) } = e^{\epsilon 
				\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$ be the lower bound for $\fvalL$
		and $g(\fvalR) = e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}$ be the upper bound for $\fvalR$
		%
		We can have:
		\[
		\begin{array}{ll}
		\frac{g(\fvalR)}{\rvarR} 
		& = e^{\epsilon
		\big(\frac{y_1}{(1 + \eta)^3} - \frac{f(a)}{(1 + \eta) ^2} 
		- y_1 + f(a) \big)}
		 \leq e^{\epsilon
		\big(- \frac{3 \eta}{1 +3 \eta}y_1 + 2 \eta f(a) \big)}
		 \leq e^{\epsilon
		\big(\frac{3 \eta}{1 +3 \eta}B + 2 \eta B \big)}
		\leq e^{5 \epsilon B \eta}\\
%
		\frac{h(\fvalL )}{\rvarR} 
		& = e^{\epsilon
		\big({y_2}{(1 + \eta)^3} - {f(a)}{(1 + \eta) ^2} 
		- y_2 + f(a) \big)}
		 \geq e^{\epsilon
		\big({3 \eta}y_1 - 2 \eta f(a) \big)}
		\geq e^{-5 \epsilon B \eta}\\
		\end{array}
		\]
		%
		Then, we can derive:
		%
		\[
		\begin{array}{ll}
		|\fvarR - \fvalL|
		& \leq |g(\fvalR ) - h(\fvalL )| \\
		& \leq e^{5 \epsilon B \eta}R - e^{-5 \epsilon B \eta} L \\
		& = L \big(  e^{ \Lambda\epsilon + 5 \epsilon B \eta} 
		- e^{-5 \epsilon B \eta} \big)\\
		& = L \big( e^{ \Lambda\epsilon} e^{5 \epsilon B \eta}
		-e^{5 \epsilon B \eta}
		+  e^{5 \epsilon B \eta}
		- e^{-5 \epsilon B \eta} \big)\\
		& = L \big( e^{ \Lambda\epsilon} e^{5 \epsilon B \eta}
		- e^{5 \epsilon B \eta}
		+  \frac{1}{(e^{ \Lambda\epsilon} - 1)}
		(e^{ \Lambda\epsilon} - 1)e^{5 \epsilon B \eta}
		- e^{-5 \epsilon B \eta} \big)\\
		& \leq L \big( e^{ \Lambda\epsilon} e^{5 \epsilon B \eta}
		- e^{5 \epsilon B \eta}
		+  \frac{1}{(e - 1)}
		(e^{ \Lambda\epsilon} - 1)e^{5 \epsilon B \eta}
		- e^{-5 \epsilon B \eta} \big) ~( by 1 \leq \Lambda \epsilon < 2)\\ 
		& = L  \frac{e}{(e - 1)} \big( e^{ \Lambda\epsilon} e^{5 \epsilon B \eta}
		- e^{5 \epsilon B \eta}
		- e^{-5 \epsilon B \eta} \big)\\
		& < L  \frac{e}{(e - 1)} \big( e^{ \Lambda\epsilon} e^{5 \epsilon B \eta}
		- e^{5 \epsilon B \eta} \big)\\
		& = L (e^{ \Lambda\epsilon} -  1) e^{\ln(\frac{e}{(e - 1)}) + 5 \epsilon B \eta}\\
		& < L (e^{ \Lambda\epsilon} -  1)e^{11 \epsilon B \eta}~ (by ~ ( \frac{1}{\epsilon} < B < 2^{42} \frac{1}{\epsilon} )) \\
		& = (\rvalR - \rvalL)e^{11 \epsilon B \eta}
		\end{array}
		\]
		In the same way, we can derive:
		\[
		|\fvarR' - \fvalL'|
		\geq 
		|h(\fvalR' ) - g(\fvalL' )|
		 > e^{-5 \epsilon B\eta} R - e^{5 \epsilon B\eta} L
		> (\rvalR' - \rvalL')e^{- 12 \epsilon B \eta}
		\]
		Then we have:
		\[
		e^0 \leq 
		\frac{|\fvalR - \fvalL |}
		{|\fvalR' - \fvalL'|}
		\leq
		\frac{|g(\fvalR ) - h(\fvalL )|}
		{|h(\fvalR' ) - g(\fvalL' )|}
		< e^{(23 \epsilon B \eta + \epsilon)}.		
		\]
%
		\subcaseL{
		$\boldsymbol{\round{f(a)}_{\Lambda} > 0 \land \valv \in (0, \round{f(a)}_{\Lambda}) } ~ (\star_1)$}
		%

		Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = x + (\frac{\Lambda}{2})$.
		By $(\star_1)$, 
		we know $\valv_1 > 0$, $\valv_2 > 0$.
		%
		\\
		%
		By Lemma and $(\star) $, we know: $\rvalL = e^{\epsilon(\valv_1 - f(a))}$ and 
		$\rvalR = e^{\epsilon(\valv_2 - f(a))}$.
		%
		\\
		%
		By Lemma \ref{lem:roundrl}, we know:
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln(\fvalL) \fbigstep \valv_1 ~~ (1)
		~~~~~~~~~~~~~~~~~
		f(a) + \frac{1}{\epsilon} \times \ln(\fvalR) \fbigstep \valv_2 ~~ (2).$$
		%
	In order to bound $\fvalL$ in terms of $\rvalL$, we have the following derivation where $P$ be the real representation of $\fvalL ~~ (\diamond)$:


{\scriptsize
\begin{mathpar}
	\inferrule*[right=bop]
	{
	\inferrule*[right=bop]
	{
		\inferrule*[right = uop]
		{
			\inferrule*[right = val-eq]
			{
				P ~~~ \text{representable}
			}
			{
				\trsenv, P 
				\trsto
				(\fvalL,
				(P, P))
			}
		}
		{
				\trsenv,
				\ln(P) 
				\trsto
				(\ln(\fvalL), \ln(P)(1 + \eta),
				\frac{\ln(P)}{(1 + \eta)})
			}
			\and
			\inferrule*[right = val-eq]
			{
			\frac{1}{\epsilon}~ \text{representable}
			}
			{
				\frac{1}{\epsilon} \trsto
				(\frac{1}{\epsilon},
				(\frac{1}{\epsilon},
			\frac{1}{\epsilon}))	
			}
		}
			{
					\trsenv,
					\frac{1}{\epsilon} \times \ln(P) 
					\trsto
					(\frac{1}{\epsilon} \times \ln(\fvalL),
					((\frac{1}{\epsilon} \times \ln(P))(1 + \eta)^2,
					%
					\frac{\frac{1}{\epsilon} \times \ln(P)}{(1 + \eta)^2}))
				}
					\and
				\inferrule*[right=val-eq]
				{f(a) ~~ \text{representable}}
				{	[],
				f(a) \trsto
				(f(a),(f(a),f(a)))
				}
			}
				{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalL),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/
				{(1 + \eta)},
				%
				(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)
				{(1 + \eta)}
				 \big)
				\bigg)
				}
		\end{mathpar}	
}
		%
		%
		By soundness theorem and (1), we have:
		%
		%
		$$(f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/
				{(1 + \eta)}
		\leq \valv_1 \leq 
		(
		f(a) + \frac{\frac{1}{\epsilon} \times \ln(P)}
		{(1 + \eta)^2}){(1 + \eta)}.
		$$ 
		Then we can get:
		%
		\\
		$$e^{(\valv_1 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}
		\leq P \leq 
		e^{(\valv_1 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}.$$
		%
		%
		By $(\diamond)$, we have:
		%
		\\
		$$e^{(\valv_1 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}
		\leq \fvalL \leq 
		e^{(\valv_1 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}.$$
		%
		%		
	In order to bound $\fvalL$ in terms of $\rvalL$, we have the following derivation where $P$ be the real representation of $\fvalL ~~ (\diamond)$:
%
%
{\scriptsize	
\begin{mathpar}
		\inferrule
		{
			\dots
		}
		{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalR),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/
				{(1 + \eta)},
				%
				(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)
				{(1 + \eta)}
				 \big)
				\bigg)
		}
		\end{mathpar}
}	
		%
		By soundness theorem and (2), we have:
		%
		%
		$$(f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/
				{(1 + \eta)}
		\leq \valv_2 \leq 
		(
		f(a) + \frac{\frac{1}{\epsilon} \times \ln(P)}
		{(1 + \eta)^2}){(1 + \eta)}.
		$$ 
		Then we can get:
		%
		\\
		$$e^{(\valv_2 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}
		\leq P \leq 
		e^{(\valv_1 (2 + \eta) - f(a))\epsilon/(1 + \eta)^2}.$$
		%
		%
		By $(\diamond)$, we have:
		%
		\\
		$$e^{(\valv_2 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}
		\leq \fvalR \leq 
		e^{(\valv_2 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}.$$
		%

		%
		For the adjacent input $a$, we have in the same way:
		%
		\\
		$$e^{(\valv_1 / (1 + \eta) - f(a'))(1 + \eta)^2\epsilon}
		\leq \fvalL' \leq 
		e^{(\valv_1 (1 + \eta) - f(a'))\epsilon/(1 + \eta)^2};$$
		%
		$$e^{(\valv_2 / (1 + \eta) - f(a'))(1 + \eta)^2\epsilon}
		\leq \fvalR' \leq 
		e^{(\valv_2 (1 + \eta) - f(a'))\epsilon/(1 + \eta)^2}.$$		
		%
		%
		%
		Let $h(\fvarL) = e^{(\valv_1 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}$, 
		$g(\fvarR) = e^{(\valv_2 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}$,
		%
		$g(\fvarL) = e^{(\valv_1 (1 + \eta) - f(a'))\epsilon/(1 + \eta)^2}$,
		$h(\fvarR) = e^{(\valv_2 / (1 + \eta) - f(a'))(1 + \eta)^2\epsilon}$
		%
		%
		\\
		%
		Since $1 - 2\eta 
		< (1 + \eta)^2 < 1 + 2.1\eta, y_1 > -B, y_2 > -B $
		we have:
		\[
		|\fvarR - \fvarL| \leq g(\fvarR) - h(\fvarL) 
		< (\rvarR - \rvarL) e^{(5B\eta\epsilon)}
		~~~~~~~ 
		|\fvarR - \fvarL| \geq h(\fvarR) - g(\fvarL) 
		> (\rvarR' - \rvarL') e^{-7B\eta \epsilon}
		\]
		%
		%
		So we can get:
		\[
		0 \leq 
		\frac{\fvarR - \fvarL}{\fvarR' - \fvarL'}
		\leq
		\frac{|g(\fvarR) - h(\fvarL) |}
		{|h(\fvarR) - g(\fvarL) |}
		< \frac{|\rvarR - \rvarL|}{|\rvarR' - \rvarL'|} e^{(12B\eta\epsilon)}
		= e^{(1 + 12B\eta)\epsilon}
		\]		
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subcaseL{$\boldsymbol{\round{f(a)}_{\Lambda} > 0 \land \valv = 0 } $}
		%
		Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv  + (\frac{\Lambda}{2})$.
		By $(\star_1)$, 
		we know $\valv_1 < 0$, $\valv_2 > 0$.
		%
		\\
		%
		By Lemma \ref{lem:idealrl} and $(\star) $, we know: $\rvalL = e^{\epsilon(\valv_1 - f(a))}$ and 
		$\rvalR = e^{\epsilon(\valv_2 - f(a))}$.
		%
		\\
		%
		By Lemma \ref{lem:roundrl}, we know:
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln(\fvalL) \fbigstep \valv_1 ~~ (1)
		~~~~~~~~~~~~~~~~~
		f(a) + \frac{1}{\epsilon} \times \ln(\fvalR) \fbigstep \valv_2 ~~ (2).$$
		%
		%
		By Lemma \ref{lem:sign} we have: $s = 1$.
		%
	In order to bound $\fvalL$ in terms of $\rvalL$, we have the following derivation where $P$ be the real representation of $\fvalL ~~ (\diamond)$:		%
		%
{\scriptsize
		\begin{mathpar}
		\inferrule
		{
		\dots
		}
		{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalL),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)/
				{(1 + \eta)}
				 \big)
				\bigg)
			}
		\end{mathpar}
	}
		%
		From soundness theorem and (1), we have:
		$$
		(f(a) + (\frac{1}{\epsilon} \times \ln(P))
		(1 + \eta)^2){(1 + \eta)}
		 \leq \valv_1 \leq 
		(f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2})/
				{(1 + \eta)}.$$
		%
		%
		Then, we can solve: 
		$e^{\epsilon 
		\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}
		\leq P \leq
		e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}$.  
		%
		\\
		%
		Let $h(\fvarL) = e^{\epsilon 
		\big( (\valv_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$, by $(\diamond)$, we have:
		$h(\fvarL) \leq \fvarL.$
%
\\
%
	In order to bound $\fvalR$ in terms of $\rvalR$, we have the following derivation where $P$ be the real representation of $\fvalR ~~ (\diamond)$:		%
%
{\scriptsize
		\begin{mathpar}
		\inferrule
		{
		 \dots
		}
		{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalR),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/
				{(1 + \eta)},
				%
				(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)
				{(1 + \eta)}
				 \big)
				\bigg)
			}
	   \end{mathpar}
}
		%
		From soundness theorem and (2), we have:
		%
		%
		$$(f(a) + (\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)/ {(1 + \eta)} 
				\leq \valv_2 \leq 
				(f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}){(1 + \eta)}.$$
		%
		%
		Then, we can solve:
		$e^{(\valv_2 / (1 + \eta) - f(a))(1 + \eta)^2\epsilon}
		\leq P \leq
		e^{(\valv_2 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}.$
		%
		\\
		%
		Let $g(\fvalR) = e^{(\valv_2 (1 + \eta) - f(a))\epsilon/(1 + \eta)^2}$, by $(\diamond)$, we also have:
		$\fvalR \leq g(\fvarR).$
		%
		\\
		%
		For the adjacent input $a'$, we have following bounds in the same ways where 
		$g(\fvarL') = e^{\epsilon 
		\frac{(\frac{\valv_1}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$ and
		$h(\fvalR') = e^{(\valv_2 / (1 + \eta) - f(a'))(1 + \eta)^2\epsilon}$:
		$$
		\fvarL' \leq g(\fvalL')
		;
		~~~~~~~~~~~~~~~~
		h(\fvalR')
		\leq \fvalR' .$$
%
%	
		Then we get:
		\[
		\begin{array}{ll}
		\fvalR - \fvarL
		\leq g(\fvalR)  - h(\fvalL)
		& < 
		e^{(2B\eta \epsilon)}\rvalR - e^{-5B\eta \epsilon} \rvalL < 
		(\rvalR - \rvalL) e^{6B\eta \epsilon}\\
		\fvalR' - \fvarL'
		\geq h(\fvalR')  - g(\fvalL')
		& > e^{(-3B\eta \epsilon)}\rvalR' - e^{5B\eta \epsilon} \rvalL > (\rvalR' - \rvalL') e^{-8B\eta \epsilon},
		\end{array}
		\]

		and privacy loss is bounded by:
		%
		\[
		e^0
		\leq
		\frac{\fvalR - \fvalL}{\fvalR' - \fvalL'}
		\leq
		\frac{|g(\fvalR)  - h(\fvalL)|}
		{|h(\fvalR')  - g(\fvalL')|}
		< e^{14B\eta \epsilon + \epsilon}
		\]

		%
		\caseL{$\boldsymbol{\valv = \round{f(a)}_{\Lambda}}$}
		%
		%
		There are 3 subcases by induction on $\round{f(a)}_{\Lambda}$:
		$\round{f(a)}_{\Lambda} < 0$, $\round{f(a)}_{\Lambda} = 0$ and $\round{f(a)}_{\Lambda} > 0$. 
		%
		\\
		%
		Without loss of generalization, we consider the worst case where the error propagate in the same direction, i.e. $\round{f(a)}_{\Lambda} < 0$.
		%
		\\
		%
		Let $\valv_1 = \valv - \frac{\Lambda}{2}$, $\valv_2 = \valv + \frac{\Lambda}{2}$, we know $\valv_1 < 0$, $\valv_2 < 0$.
		%
		For input $a$, by {\textbf Lemma. \ref{lem:sign}}, {\textbf Lemma. \ref{lem:sign}} and  \ref{lem:roundrl}, we have:
		 $s = 1$ or $-1$;
		$\rvalR = \fvalR = 1$ and
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln(\fvalL) \fbigstep \valv_1 ~~ (1).$$		%
		%
		\begin{itemize}
		\subcaseL{$s = 1$}
		%
		%
	In order to bound $\fvalL$ in terms of $\rvalL$ when $s = 1$ (denoted by $\fvalL^+$ and $\rvalL^+$), we have the following derivation where $P$ be the real representation of $\fvalL^+ ~~ (\diamond)$, :		%
		%
{\scriptsize
		\begin{mathpar}
		\inferrule
		{
		\dots
		}
		{
				\trsenv,
				f(a) + \frac{1}{\epsilon} \times \ln(P)
				\trsto
				\bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(\fvalL),
						%
				\big( (f(a) + 
				(\frac{1}{\epsilon} \times \ln(P))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(P)}
				{(1 + \eta)^2}
				)/
				{(1 + \eta)}
				 \big)
				\bigg)
			}
		\end{mathpar}
	}
	%
	%
	By soundness and (1), we have:
		$ h(\fvalL^+) \leq \fvalL^+ \leq g(\fvalL^+),$
		where 
		$h(\fvalL^+) = e^{\epsilon 
				\big( (y_1(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$ and
		$g(\fvalL^+) = e^{\epsilon 
				\frac{(\frac{y_1}{1 + \eta} - f(a))}{(1 + \eta)^2}}$.
		%
		\\
		%
	We still computed the looser bounds for $\fvalR^+$ in terms of $\rvalR^+$ (even though $\fvalR = \rvalR = 1$), which will be used later:
%
		$ h(\fvalR^+) \leq \fvalR^+ \leq g(\fvalR^+),$
		where 
		$h(\fvalR^+) = e^{\epsilon 
				\big( (\valv_2(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$ and
		$g(\fvalR^+) = e^{\epsilon 
				\frac{(\frac{\valv_2}{1 + \eta} - f(a))}{(1 + \eta)^2}}$.
		% 
		\subcaseL{$s = -1$}
		%
	In order to bound $\fvalL$ in terms of $\rvalL$ when $s = -1$ (denoted by $\fvalL^-$ and $\rvalL^-$), we have the following derivation where $P$ be the real representation of $\fvalL^- ~~ (\diamond)$, :		%
		%
		$e^{\epsilon 
				\big( (f(a) - y_2(1 + \eta)) (1 + \eta)^2) \big)}
        \leq
        \fvalL^- \leq
        e^{\epsilon 
				\frac{(f(a) - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.
		%
		% 
		%
	\end{itemize}
		%
		%
		For input $a'$, by \textbf{Lemma \ref{lem:sign}} and $f(a) + 1 = f(a')$ we have $s = 1$, 
		%
		%
		By Lemma \ref{lem:idealrl} and $(\star) $, we know: $\rvalL = e^{\epsilon(\valv_1 - f(a'))}$ and 
		$\rvalR = e^{\epsilon(\valv_2 - f(a'))}$.
		%
		\\
		%
		By Lemma \ref{lem:roundrl}, we know:
		%
		$$f(a') + \frac{1}{\epsilon} \times \ln(\fvalL') \fbigstep \valv_1 ~~ (1)
		~~~~~~~~~~~~~~~~~
		f(a') + \frac{1}{\epsilon} \times \ln(\fvalR') \fbigstep \valv_2 ~~ (2).$$
		%
		By our semantics and soundness theorem , we have following bounds:
		%
		\\
		%
		$h(\fvalR') \leq \fvalR' \leq g(\fvalR')$,
		where 
		$h(\fvalR') = e^{\epsilon 
		\big( (\valv_2(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$ 
		and
		$g(\fvalR') = e^{\epsilon \frac{(\frac{\valv_2}{1 + \eta} - f(a'))}
		{(1 + \eta)^2}}$
		% 
		\\
		%
		$h(\fvalL') \leq \fvalL' \leq g(\fvalL')$, 
		where 
		$h(\fvalL') = e^{\epsilon 
		\big( (\valv_1(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$ 
		and
		$g(\fvalL') = e^{\epsilon \frac{(\frac{\valv_1}{1 + \eta} - f(a'))}
		{(1 + \eta)^2}}$.

		% \begin{mathpar}
		% \end{mathpar}

		We have following bounds on their ratios:
		%
		\[
		\frac{h(\fvalL^+)}{\rvalL^+} 
		= e^{\epsilon 
		\big(
		(1 + \eta)^3 \valv_1 - (1 + \eta)^2f(a) - \valv_1 + f(a)
		\big)}
		> e^{-3\epsilon B \eta},
		~~~
		\frac{g{(\fvalR^+)}}{\rvalR^+} = e^{\epsilon 
		\big(
		frac{\valv_2}{(1 + \eta)^3} - \frac{f(a)}{(1 + \eta)^2} - \valv_2 + f(a)
		\big)}
		< e^{3\epsilon B \eta}.
		\]
		%
		%
		\[
		\frac{h(\fvalR')}{\rvalR'} = e^{\epsilon 
		\big(
		(1 + \eta)^2f(a) - (1 + \eta)^3 \valv_2 - f(a) + \valv_2
		\big)}
		> e^{-2\epsilon B \eta},
		%
		~~~~~~~~~~~~
		%
		\frac{g{(\fvalL')}}{\rvalL'} = e^{\epsilon 
		\big(
		\frac{f(a)}{(1 + \eta)^2} - \frac{\valv_2}{(1 + \eta)^3} - f(a) + \valv_2
		\big)}
		< e^{2\epsilon B \eta},
		\]
		%
		Using the bound on their ratios, we can get following bounds on $|\fvalR^+ - \fvalL^+|$ 
		and $|\fvalR' - \fvalL'|$:
		%
		\[
		|\fvalR^+ - \fvalL^+|
		\leq
		|g{(\fvalR^+)} - h(\fvalL^+)| 
		< e^{3\epsilon B \eta} \rvalR^+ - e^{-3\epsilon B \eta}\rvalL^+ 
		< (\rvalR^+ - \rvalL^+) e^{7\epsilon B \eta},
		\]
		%
		\[
		|\fvalR' - \fvalL'|
		\geq
		|h{(\fvalR')} - g(\fvalL')| 
		> e^{-2\epsilon B \eta} \rvalR' - e^{2\epsilon B \eta}\rvalL' 
		> (\rvalR' - \rvalL') e^{-5\epsilon B \eta}
		\]
		%
		Then we have the following bounds on privacy loss:
		%
		\[
		e^0
		\leq
		\frac{2 - (\fvalL^+ + \fvalL^-)}
		{\fvalR' - \fvalL'}
		\leq
		\frac{2 - (h(\fvalL^+) + h(\fvalL^-))}
		{h(\fvalR') - g(\fvalL')}
		< \frac{g(\fvalR^+) - h(\fvalL^+)}
		{h(\fvalR') - g(\fvalL')}
		< \frac{e^{7\epsilon B \eta}
		(\rvalR^+ - \rvalL^+)}
		{e^{-5\epsilon B \eta} 
		(\rvalR' - \rvalL')}
		= e^{12\epsilon B \eta + \epsilon}
		\]
		%
		%
		%
		\caseL{$\boldsymbol{x \in (\round{f(a)}_{\Lambda}, \round{f(a')}_{\Lambda})}$}
		%
		Since the output set $(\round{f(a)}_{\Lambda}, \round{f(a')}_{\Lambda})$ is empty when $\Lambda \geq 1$, so we consider the situation where $\Lambda < 1$.
		%
		There are two subcases in this case : $x >0$ and $x < 0$.
		%
		Without loss of generalization, we consider the worst case where error propagate in the same direction, i.e., $\round{f(a')}_{\Lambda}) < 0$. The bounds derived for $l, r$ and $l', r'$ under input $a$ and $a'$ are as follows:
		%
		\\
		%
		For input $a$:
		%
		\\
		%
		$\ubar{R} = e^{\epsilon 
				\big( (f(a) - y_2(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R} = e^{\epsilon 
				\frac{(f(a) - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.  
		% 
		\\
		%
		$\ubar{L} = e^{\epsilon 
				\big( (f(a) - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L} = e^{\epsilon 
				\frac{f(a) - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.
		%
		\\
		For input $a'$:
		%
		\\
		% 
		$\ubar{R'} = e^{\epsilon 
				\big( (y_2(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R'} = e^{\epsilon 
				\frac{ \frac{y_2}{1 + \eta} - f(a') }{(1 + \eta)^2}}$.
		%
		\\
		%
		%
		$\ubar{L'} = e^{\epsilon 
				\big( (y_1(1 + \eta) - f(a') ) (1 + \eta)^2) \big)}$,
		%
		$\bar{L'} = e^{\epsilon 
				\frac{\frac{y_1}{1 + \eta} - f(a') }{(1 + \eta)^2}}$.
		%
		\\
		%
		The bounds on their ratio are as follows:
		%
		\[
		\frac{\ubar{R}}{R} > e^{-5B\eta \epsilon}, 
		~ \frac{\bar{R}}{R} < e^{5B\eta \epsilon};
		~~~~
		\frac{\ubar{R'}}{R'} > e^{-5B\eta \epsilon}, 
		~ \frac{\bar{R'}}{R'} < e^{5B\eta \epsilon}.
		\]
		%
		And the bounds on $|\ubar{R} - \bar{L}|$ and $|\bar{R'} - \ubar{L'}|$ are as follows:
		%
		\[
		|\ubar{R} - \bar{L}| > e^{-12 B\eta \epsilon}|R - L|, 
		~ |\bar{R'} - \ubar{L'}| < e^{11 B\eta \epsilon}|R' - L'|
		\]
		%
		So we have the privacy loss is bounded by:
		%
		\[
		\frac{|\ubar{R} - \bar{L}|}{|\bar{R'} - \ubar{L'}|}
		> \frac{e^{-12 B\eta \epsilon}|R - L|}{e^{11 B\eta \epsilon}|R' - L'|}
		= e^{-23B \eta \epsilon - \epsilon}
		\]
		%
		%
		%
		\caseL{$\boldsymbol{x = \round{f(a')}_{\Lambda}}$}
		%
		%
		%
		This case is symmetric with the case where $\boldsymbol{x = \round{f(a')}_{\Lambda}}$.
		%
		It can also be split into 3 subcases by: $\round{f(a')}_{\Lambda} < 0$, $\round{f(a')}_{\Lambda} = 0$ and $\round{f(a')}_{\Lambda} > 0$. 
		%
		Without loss of generalization, we consider the worst case where the error propagate in the same direction, i.e. $\round{f(a')}_{\Lambda} < 0$.\\
		%
		From this assumption, let $y_1 = x - (\frac{\Lambda}{2})$, $y_2 = x + (\frac{\Lambda}{2})$, we know $y_1 < 0$, $y_2 < 0$.
		%
		Since $f(a) + 1 = f(a')$, we also have $\round{f(a)} < \round{f(a')} <0$.
		So, we know $s$ can only be $-1$ for input $a$ but $s$ can be $1$ or $-1$ for input $a'$.
		%
		\\
		%
		For input $a'$, 
		Let $S = s$, $L' = e^{\epsilon(y_1 - f(a'))}$ and $R' = e^{\epsilon(y_2 - f(a))}$, we have $\forall u \in (L', R')$:
		$\expr_{\snap''} \rbigstep \varx$.
		%
		\\
		%
		Let $l'$ and $r'$ be the range where $\forall u \in (l', r')$ and $S = s$, s.t.
		$\expr_{\snap''} \fbigstep \varx$.
		%
		\\
		%
		We know: $\ubar{L'} < l' < \bar{L'}$, $\ubar{R'} < r < \bar{R'}$ s.t.:
		%
		$$f(a) + \frac{1}{\epsilon} \times \ln (l) \fbigstep y_1
		\land
		f(a) + \frac{1}{\epsilon} \times \ln (r) \fbigstep y_2.$$
		%
		Induction on s, we have:
		When $s = 1$.
		%
		\\
		%
		The transition from $R'$ to $r'$ given the transition environment 
		$\trsenv = [U \mapsto (R'_{+}, (\ubar{R'_{+}}, \bar{R'_{+}})), S \mapsto (1, (1, 1))]$ is shown as following:
		%
		%
		\begin{mathpar}
		\inferrule
		{
		 \trsenv, U
		 \trsto
		 R_+, ( R_+', R_+' )
		}
		{
		 \inferrule
		 {
		  \trsenv, \ln(U)
		  \trsto
		  \big(\ln (R_+), 
		  (\ln(R_+')(1 + \eta), \frac{\ln(R_+')}{1+\eta}) \big)
		 }
		 {
		  \inferrule
		  {
		   \trsenv, \frac{1}{\epsilon}\ln(U)
		   \trsto
		   \frac{1}{\epsilon} \times \ln (R_+), 
		   \big(
		   \frac{1}{\epsilon}\ln(R_+')(1 + \eta)^2, 
		   \frac{1}{\epsilon}\frac{\ln(R_+')}{(1+\eta)^2}
		   \big)
		  }
		  {
		   \inferrule
		   {
		    \trsenv, f(a) + \frac{1}{\epsilon}\ln(U)
			\trsto
			\bigg(
			f(a) + \frac{1}{\epsilon} \times \ln (R_+), 
			\big(
			(f(a) + \frac{1}{\epsilon}\ln(R_+')(1 + \eta)^2)(1 + \eta), 
			(f(a) + \frac{1}{\epsilon}\frac{\ln(R_+')}{(1+\eta)^2}) / (1 + \eta)
			\big) \bigg)
		   }
		   {
		   \trsenv, \snap'(a) \trsto 
		   \trsenv[y \mapsto 
		   (f(a) + \frac{1}{\epsilon} \times \ln (R_+), 
		   	(\err_1, \err_2))]
		   }
		  }
		 }
		}
		\end{mathpar}
		%
		%
		From soundness theorem, we have  $\err_1 \leq y_2 \leq \err_2$. Then we can get following bounds for $r$:\\
		%
		%
		$\ubar{R_+'} = e^{\epsilon 
				\big( (y_2(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R_+'} = e^{\epsilon 
				\frac{(\frac{y_2}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$.  
		%
		\\
		%
		Since $y_2 = \round{f(a)} + \frac{\Lambda}{2}$, we have 
		$e^{\epsilon 
				\big( (y_2 - f(a))) \big)} > 1$, so actually we know $R_+' = r_+' = 1$.
		%
		% 
		\\
		%
		We can also derive the bound for $l$ in the same way as:\\
		$\ubar{L_+'} = e^{\epsilon 
				\big( (y_1(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L_+'} = e^{\epsilon 
				\frac{(\frac{y_1}{1 + \eta} - f(a'))}{(1 + \eta)^2}}$.
		%

		% 
		When $s = -1$, we can derive following bounds in the same way for $l$ and $r$:\\
		%
		$\ubar{L_-'} = e^{\epsilon 
				\big( (f(a') - y_2(1 + \eta)) (1 + \eta)^2) \big)}$,
		%
		$\bar{L_-'} = e^{\epsilon 
				\frac{(f(a') - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.\\
		%
		% 
		$\ubar{R_-'} = e^{\epsilon 
				\big( (f(a') - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R_-'} = e^{\epsilon 
				\frac{(f(a') - \frac{y_1}{1 + \eta})}{(1 + \eta)^2}}$.\\
		%
		Since $y_1 = \round{f(a')} - \frac{\Lambda}{2}$, 
		%
		we have $e^{\epsilon \big( (f(a') - y_1)) \big)} > 1$, so actually we know $R_-' = r_-' = 1$.
		%
		\\
		%
		For input $a$, we have only one case where $s = -1$, the following bound can be derived:
		%
		\\
		%
		$\ubar{R} = e^{\epsilon 
				\big( f(a) - (y_2(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R} = e^{\epsilon 
				\frac{(f(a) - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.  
		% 
		\\
		%
		$\ubar{L} = e^{\epsilon 
				\big( (f(a) - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L} = e^{\epsilon 
				\frac{f(a) - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.

		% \begin{mathpar}
		% \end{mathpar}

		We have following bounds on their ratios:
		%
		\[
		\frac{\ubar{R_+'}}{R_+'} = e^{\epsilon 
		\big(
		(1 + \eta)^3 y_2 - (1 + \eta)^2f(a) - y_2 + f(a)
		\big)}
		> e^{-3\epsilon B \eta},
		\frac{\bar{R_+'}}{R_+'} = e^{\epsilon 
		\big(
		frac{y_2}{(1 + \eta)^3} - \frac{f(a)}{(1 + \eta)^2} - y_2 + f(a)
		\big)}
		< e^{3\epsilon B \eta},
		\]
		%
		The same bound for $L_+'$ by substituting $y_2$ with $y_1$, and similar bound for $L, R$.
		%
		\[
		\frac{\ubar{R}}{R} = e^{\epsilon 
		\big(
		(1 + \eta)^2f(a) - (1 + \eta)^3 y_2 - f(a) + y_2
		\big)}
		> e^{-2\epsilon B \eta},
		%
		\frac{\bar{R}}{R} = e^{\epsilon 
		\big(
		\frac{f(a)}{(1 + \eta)^2} - frac{y_2}{(1 + \eta)^3} - f(a) + y_2
		\big)}
		< e^{2\epsilon B \eta},
		\]
		%
		Using the bound on their ratios, we can get following bounds on $|\bar{R_-'} - \ubar{L_-'}|$ and $|\ubar{R} - \bar{L}|$:
		%
		\[
		|\bar{R_-'} - \ubar{L_-'}| < e^{3\epsilon B \eta} R - e^{-3\epsilon B \eta}L < (R_-' - L_-') e^{7\epsilon B \eta},
		%
		|\ubar{R} - \bar{L}| > e^{-2\epsilon B \eta} R - e^{2\epsilon B \eta}L > (R - L) e^{-5\epsilon B \eta}
		\]
		%
		Then we have the following bounds on privacy loss:
		%
		\[
		\frac{\ubar{R} - \bar{L}}{2 - (\ubar{L_+'} + \ubar{L_-'})}
		> \frac{\ubar{R} - \bar{L}}{\bar{R_-'} - \ubar{L_-'}}
		> \frac{e^{-5\epsilon B \eta} (R - L)}
		{e^{7\epsilon B \eta}(R_-' - L_-')}
		= e^{-12\epsilon B \eta - \epsilon}
		\]
		%
		%
		%
		\caseL{$\boldsymbol{x \in  (\round{f(a')}_{\Lambda}, B)}$}
		%
		This case can also be split into 3 subcases symmetric with the case where $\boldsymbol{x \in  (-B, \round{f(a)}_{\Lambda})}$:
		%
		%
		%
		\subcaseL{$\boldsymbol{\round{f(a')}_{\Lambda} > 0 \lor \round{f(a')}_{\Lambda} < 0 \land x \in  (0, B)}$}
		%
		%
		let $y_1 = x - \frac{\Lambda}{2}$, $y_2 = x + \frac{\Lambda}{2}$, we have $y_1, y_2 > 0$. The bounds derived for $l, r$ and $l', r'$ under input $a$ and $a'$ in this case are as follows:
		%
		\\
		For input $a'$:
		%
		\\
		% 
		$\ubar{R'} = e^{\epsilon 
				\big( (f(a') - \frac{y_2}{1 + \eta}) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R'} = e^{\epsilon 
				\frac{(f(a') - y_2(1 + \eta))}{(1 + \eta)^2}}$.
		%
		\\
		%
		%
		$\ubar{L'} = e^{\epsilon 
				\big( (f(a') - \frac{y_1}{1 + \eta})) (1 + \eta)^2) \big)}$,
		%
		$\bar{L'} = e^{\epsilon 
				\frac{(f(a') - y_1(1 + \eta)}{(1 + \eta)^2}}$.
		%
		\\
		%
		For input $a$:
		%
		\\
		%
		$\ubar{R} = e^{\epsilon 
				\big( (f(a) - \frac{y_2}{1 + \eta}) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R} = e^{\epsilon 
				\frac{(f(a) - y_2(1 + \eta))}{(1 + \eta)^2}}$.  
		% 
		\\
		%
		$\ubar{L} = e^{\epsilon 
				\big( (f(a) - \frac{y_1}{1 + \eta}) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L} = e^{\epsilon 
				\frac{f(a) - y_1(1 + \eta)}{(1 + \eta)^2}}$.
		%
		%
		The bounds on their ratio are as follows:
		%
		\[
		\frac{\ubar{R}}{R} > e^{-3B\eta \epsilon}, 
		~ \frac{\bar{R}}{R} < e^{3B\eta \epsilon}
		\]
		%
		And the bounds on $|\ubar{R} - \bar{L}|$ and $|\bar{R'} - \ubar{L'}|$ are as follows:
		%
		\[
		|\ubar{R} - \bar{L}| > e^{-7 B\eta \epsilon}|R - L|, 
		~ |\bar{R'} - \ubar{L'}| < e^{7 B\eta \epsilon}|R' - L'|
		\]
		%
		So we have the privacy loss is bounded by:
		%
		\[
		\frac{|\ubar{R} - \bar{L}|}{|\bar{R'} - \ubar{L'}|}
		> \frac{e^{-7 B\eta \epsilon}|R - L|}{e^{7 B\eta \epsilon}|R' - L'|}
		= e^{-14B \eta \epsilon - \epsilon}
		\]
		%
		\subcaseL{$\boldsymbol{\round{f(a')}_{\Lambda} < 0 \land x \in  (\round{f(a')}_{\Lambda}, 0)}$}
		%		
		let $y_1 = x - \frac{\Lambda}{2}$, $y_2 = x - \frac{\Lambda}{2}$, we have $y_1, y_2 < 0$. The bounds derived for $l, r$ in this case are as follows:
		%
		\\
		For input $a'$:
		%
		\\
		% 
		$\ubar{R'} = e^{\epsilon 
				\big( (f(a') - y_2(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R'} = e^{\epsilon 
				\frac{(f(a') - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.
		%
		\\
		%
		%
		$\ubar{L'} = e^{\epsilon 
				\big( (f(a') - y_1(1 + \eta) ) (1 + \eta)^2) \big)}$,
		%
		$\bar{L'} = e^{\epsilon 
				\frac{(f(a') - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.
		%
		\\
		%
		For input $a$:
		%
		\\
		%
		$\ubar{R} = e^{\epsilon 
				\big( (f(a) - y_2(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R} = e^{\epsilon 
				\frac{(f(a) - \frac{y_2}{1 + \eta})}{(1 + \eta)^2}}$.  
		% 
		\\
		%
		$\ubar{L} = e^{\epsilon 
				\big( (f(a) - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L} = e^{\epsilon 
				\frac{f(a) - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.
		%
		\\
		%
		The bounds on their ratio are as follows:
		%
		\[
		\frac{\ubar{R}}{R} > e^{-5B\eta \epsilon}, 
		~ \frac{\bar{R}}{R} < e^{5B\eta \epsilon}
		\]
		%
		And the bounds on $|\ubar{R} - \bar{L}|$ and $|\bar{R'} - \ubar{L'}|$ are as follows:
		%
		\[
		|\ubar{R} - \bar{L}| > e^{-12 B\eta \epsilon}|R - L|, 
		~ |\bar{R'} - \ubar{L'}| < e^{11 B\eta \epsilon}|R' - L'|
		\]
		%
		So we have the privacy loss is bounded by:
		%
		\[
		\frac{|\ubar{R} - \bar{L}|}{|\bar{R'} - \ubar{L'}|}
		> \frac{e^{-12 B\eta \epsilon}|R - L|}{e^{11 B\eta \epsilon}|R' - L'|}
		= e^{-23B \eta \epsilon - \epsilon}
		\]
		%
		%
		\subcaseL{$\boldsymbol{\round{f(a')}_{\Lambda} < 0 \land x = 0}$}
		%
		let $y_1 = x - \frac{\Lambda}{2}$, $y_2 = x - \frac{\Lambda}{2}$, we have $y_1 < 0$ and $y_2 > 0$. The bounds derived for $l, r$ in this case are as follows:
		%
		\\
		For input $a'$:
		%
		\\
		% 
		$\ubar{R'} = e^{\epsilon 
				\big( (f(a') - \frac{y_2}{1 + \eta}) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R'} = e^{\epsilon 
				\frac{(f(a') - y_2(1 + \eta))}{(1 + \eta)^2}}$.
		%
		\\
		%
		%
		$\ubar{L'} = e^{\epsilon 
				\big( (f(a') - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L'} = e^{\epsilon 
				\frac{f(a') - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.
		%
		\\
		%
		For input $a$:
		%
		\\
		%
		$\ubar{R} = e^{\epsilon 
				\big( (f(a) - \frac{y_2}{1 + \eta}) (1 + \eta)^2) \big)}$, 
		%
		$\bar{R} = e^{\epsilon 
				\frac{(f(a) - y_2(1 + \eta))}{(1 + \eta)^2}}$.  
		% 
		\\
		%
		$\ubar{L} = e^{\epsilon 
				\big( (f(a) - y_1(1 + \eta)) (1 + \eta)^2) \big)}$, 
		%
		$\bar{L} = e^{\epsilon 
				\frac{f(a) - \frac{y_1}{1 + \eta}}{(1 + \eta)^2}}$.
		%
		\\
		%
		The bounds on their ratio are as follows:
		%
		\[
		\frac{\ubar{R}}{R} > e^{-3B\eta \epsilon}, 
		~ \frac{\bar{R}}{R} < e^{3B\eta \epsilon}
		\frac{\ubar{L}}{L} > e^{-5B\eta \epsilon}, 
		~ \frac{\bar{L}}{L} < e^{5B\eta \epsilon}
		\]
		%
		And the bounds on $|\ubar{R} - \bar{L}|$ and $|\bar{R'} - \ubar{L'}|$ are as follows:
		%
		\[
		|\ubar{R} - \bar{L}| > e^{-8 B\eta \epsilon}|R - L|, 
		~ |\bar{R'} - \ubar{L'}| < e^{8 B\eta \epsilon}|R' - L'|
		\]
		%
		So we have the privacy loss is bounded by:
		%
		\[
		\frac{|\ubar{R} - \bar{L}|}{|\bar{R'} - \ubar{L'}|}
		> \frac{e^{-8 B\eta \epsilon}|R - L|}{e^{8 B\eta \epsilon}|R' - L'|}
		= e^{-16B \eta \epsilon - \epsilon}
		\]
		%
		%
		%
		\caseL{$\boldsymbol{x = B}$}
		%
		%
		We know $s = -1$, $L = l = 0$ and $R = b$, so we only need to estimate the right side range $r$ in this case. The bounds derived for $r, r'$ are as following:
		\[
		\begin{array}{c}
		\ubar{R} = e^{\epsilon 
		\big( (f(a) -  \frac{x}{1 + \eta}) (1 + \eta)^2) \big)},
		%
		\bar{R} = e^{\epsilon 
		\frac{(f(a) - x(1 + \eta))}{(1 + \eta)^2}}
		\\
		%
		\ubar{R'} = e^{\epsilon 
		\big( (f(a') -  \frac{x}{1 + \eta}) (1 + \eta)^2) \big)},
		%
		\bar{R'} = e^{\epsilon 
		\frac{(f(a') - x(1 + \eta))}{(1 + \eta)^2}}
		\end{array}
		\]
		%		
		The privacy loss of $\snap(a)$ in this case is bounded by:
		%
		\[
		\begin{array}{ll}
		\frac
		{\frac{1}{2}(\ubar{R} - 0)}
		{\frac{1}{2}(\bar{R'} - 0)}
		& = e^{\epsilon
		\bigg(
		\big( (f(a) -  \frac{x}{1 + \eta}) (1 + \eta)^2) \big)
		-
		\frac{(f(a') - x(1 + \eta))}{(1 + \eta)^2}
		\bigg)}\\
		& = e^{\epsilon
		\bigg(
		f(a)(1 + \eta)^2 - x(1 + \eta) 
		- \frac{f(a)}{(1 + \eta)^2} + \frac{x}{(1 + \eta)}   
		\bigg)} ~ (\star)
		\end{array}
		\]
		%
		Since $ 1 + 2.1\eta > (1 + \eta)^2 > 1 + 2\eta$ and $\frac{1}{(1 + \eta)^2} > 1 - 2 \eta$, we have:
		%
		\[
		\begin{array}{ll}
		(\star) & > e^{\epsilon \big(
		(1 + 2\eta) f(a) - \frac{\eta(\eta + 2)}{1 + \eta} x
		- \frac{1}{1 + 2\eta}(f(a) + 1)
		\big)}\\
		%
		& = e^{\epsilon\big(
		\frac{4\eta(\eta + 1)}{1 + 2\eta} f(a) 
		- \frac{\eta(\eta + 2)}{1 + \eta} x
		- \frac{1}{1 + 2\eta}		
		\big)}\\
		%
		& > e^{\epsilon\big( -B \eta
		\frac{4(\eta + 1)}{1 + 2\eta} + \frac{(\eta + 2)}{1 + \eta} x - 1	
		\big)}\\
%
		& > e^{\epsilon(-6 \eta B - 1)}
		\end{array}
		\]
	%	
	\end{itemize}



\end{proof}

\newpage
\section{Syntax - Functional}
Following are the syntax of our system:
%
\[\begin{array}{llll}
\mbox{Expr.} & \expr & ::= & \varx 
	~|~ \rval ~|~ \fval
	%
	~|~ F(\data) ~|~ \expr \bop \expr
	%
	~|~ \uop (\expr) ~|~ \elet ~ \varx \samplel \edistr ~ \ein ~ \expr
	~|~ \elet ~ \varx = \expr_1 ~ \ein ~ \expr_2 \\
%
\mbox{Binary Operation} & \bop & ::= & + ~|~ - ~|~ \times ~|~ \div \\
%
\mbox{Unary Operation} & \uop & ::= & \ln ~|~ - ~|~ \round{\cdot} 
	%
	~|~ \clamp_B(\cdot) \\
%
\mbox{Value} & \valv & ::= & \rval ~|~  \fval \\
%
\mbox{Distribution} & \edistr & ::= & \uniform ~|~ \bernoulli \\ 
%
\mbox{Error} & \err & ::= & (\expr, \expr)
%
\end{array}
\]


\newpage
\section{Semantics - Functional}

The transition semantics with relative floating point computation error are shown in Figure. \ref{fig_func_trans_semantics_exp}. The semantics are $\expr \trsto (\err)$, which means a real expression $\expr$ can be transited in floating point computation with error bound $\err$, $\eta$ is the machine epsilon.

We assume the SAMPLE and F(D) semantics for floating point and real computation are the same. $\edistr \bigstep_{\$} \valv$ represents $\valv$ is sampled from the distribution $\edistr$.

\begin{figure}
\begin{mathpar}
\inferrule*[right = val]
{
	\rval \geq 0
}
{
	\rval
	\trsto
	\big( \frac{\rval}{(1 + \eta)}, \rval(1 + \eta) \big)
}
%
\and
%
\inferrule*[right = val-neg]
{
	\rval < 0
}
{
	\rval
	\trsto
	\big( \rval(1 + \eta), \frac{\rval}{(1 + \eta)} \big)
}
%
\and
%
\inferrule*[right = val-eq]
{
	\rval = \floaten(\rval)
}
{
	\rval
	\trsto
	( \rval, \rval )
}
%
\and
%
\inferrule*[right = f(d)]
{
	\empty
}
{
	f(D)
	\trsto
	( f(D), f(D) )
}
%
\and
%
\inferrule*[right = sample]
{
	\empty
}
{
	\samplel \edistr
	\trsto
	( \samplel \edistr, \samplel \edistr )
}
%
\and
%
\inferrule*[right = bop]
{
	\expr^1 \trsto (\ubar{\rval^1}, \bar{\rval^1})
	\and
	\expr^2 \trsto (\ubar{\rval^2}, \bar{\rval^2})
	\and
	\expr^1 * \expr^2 \geq 0
}
{
    \expr^1 * \expr^2
    \trsto 
    \big(
    \frac{\ubar{\rval^1} * \ubar{\rval^2}}{(1 + \eta)}, 
    (\bar{\rval^1} * \bar{\rval^2})(1 + \eta)
    \big)
}
%
\inferrule*[right = bop-neg]
{
	\expr^1 \trsto  (\ubar{\rval^1}, \bar{\rval^1})
	\and
	\expr^2 \trsto  (\ubar{\rval^2}, \bar{\rval^2})
	\and
	\expr^1 * \expr^2 < 0
}
{
    \expr^1 * \expr^2
    \trsto 
    \big(
    (\bar{\rval^1} * \bar{\rval^2})(1 + \eta),
    \frac{\ubar{\rval^1} * \ubar{\rval^2}}{(1 + \eta)}
    \big)
}%
\and
%
\inferrule*[right = uop]
{
	\expr \trsto (\ubar{\rval}, \bar{\rval})
	\and
	\uop (\expr) \geq 0
}
{
    \uop(\expr)
    \trsto 
    \big(
    \frac{\uop(\ubar{\rval})}{(1 + \eta)}, 
    (\uop(\bar{\rval}))(1 + \eta)
    \big)
}
%
\inferrule*[right = uop-neg]
{
	\expr \trsto  (\ubar{\rval}, \bar{\rval})
	\and
	\uop (\expr) < 0
}
{
    \uop(\expr)
    \trsto 
    \big(
    (\uop(\ubar{\rval}))(1 + \eta),
    \frac{\uop(\bar{\rval})}{(1 + \eta)}
    \big)
}
\end{mathpar}
\caption{Semantics of Transition for Expressions with Relative Floating Point Error}
\label{fig_func_trans_semantics_exp}
\end{figure}



\begin{figure}
\begin{mathpar}
\inferrule*[right = fval]
{
	\floaten(\rval) = \fval
}
{
	\rval
	\bigstep
	\fval
}
%
\and
%
\inferrule*[right = fbop]
{
	\expr^1 \bigstep \fval^1
	\and
	\expr^2 \bigstep \fval^2
	\and
	\floaten(\fval^1 \bop \fval^2) = \fval
}
{
    \expr^1 \bop \expr^2 \bigstep \fval
}
%
\and
%
\inferrule*[right = fuop]
{
	\expr \bigstep \fval',
	\and
	\floaten(\uop (\fval')) = \fval
}
{
    \uop(\expr) \bigstep \fval
}
\end{mathpar}
\caption{Semantics of Evaluation in Floating Point Computation}
\label{fig_fl_semantics_exp}
\end{figure}

\begin{figure}
\begin{mathpar}
\inferrule*[right = rval]
{
	\empty
}
{
	\rval
	\bigstep
	\rval
}
%
\and
%
\inferrule*[right = rbop]
{
	\expr^1 \bigstep \rval^1
	\and
	\expr^2 \bigstep \rval^2
	\and
	\rval^1 \bop \rval^2 = \rval
}
{
    \expr^1 \bop \expr^2 \bigstep \rval
}
%
\and
%
\inferrule*[right = ruop]
{
	\expr \bigstep \rval',
	\and
	\uop (\rval') = \rval
}
{
    \uop(\expr) \bigstep \rval
}
%
\and
%
\inferrule*[right = sample]
{
	 \fval \leftarrow \edistr^{\diamond}
}
{
	\samplel \edistr \bigstep \fval
}
%
\and
%
\inferrule*[right = f(d)]
{
	f(D) = \fval
}
{
	f(D) \bigstep \fval
}
\end{mathpar}
\caption{Semantics of Evaluation in Real Computation}
\label{fig_func_real_semantics_exp}
\end{figure}


\begin{thm}[Soundness Theorem]
Given $\expr$ where the transition 
$\expr \trsto (\ubar{\rval}, \bar{\rval})$ holds, 
then if $\expr$ evaluates to $c$ in floating point computation and 
$\ubar{\rval}$ and $\bar{\rval}$ evaluates to $\ubar{r}$ and $\bar{r}$ in real computation, we have: 
\[
\ubar{r} \leq c \leq \bar{r}
% ~~ \land ~~ 
% \frac{r^1}{r^2} \leq \frac{c}{r} \leq \frac{r^2}{r^1}.
\]
\end{thm}
% \begin{proof}
% Induction on $\expr$, we have following cases:

% \end{proof}

\newpage
\bibliographystyle{plain}
\bibliography{verifysnap.bib}



\end{document}















